{
  "hash": "0b87d2f0ed4b619665cb416a44d9d67a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Learning to Love Regexes By Learning Them\"\nsubtitle: \"I Promised Myself I Wouldn't Do This Again\"\ndescription: \"Building a regex generator for self-contained, well-defined string detection problems is a very effective way to learn regular expressions.\"\nformat:\n  html:\n    reference-location: margin\n    other-links:\n      - text: Regex Cheatsheet\n        icon: bookmark-plus\n        href: https://github.com/raredd/regex\n      - text: RexEgg\n        icon: bookmark-plus\n        href: https://www.rexegg.com/\n      - text: Regex in R\n        icon: bookmark-plus\n        href: https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html\neditor_options: \n  chunk_output_type: console\ncallout-appearance: simple\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n# TODO {.unnumbered}\n\n   * The *postfix* for a **wildcard** that begins with a **letter** is `[0-9]{n}`.\n   * In `remove_redundant()`, try pmap for `rr()` step.\n   * Groups 3, 4 & 5 beginning with letters.\n   * Group 5 ending with letters.\n\n\n\n\n\n{{< pagebreak >}}\n\n\n\n\n\n\n::: {#note-good .callout-note collapse=\"true\"}\n\n### Good Examples\n\n### Case 1\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlist(\"L80\", \n     c(\"L56\", \"L59\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"L80\"\n\n[[2]]\n[1] \"L56\" \"L59\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, \"^L56|^L59|^L80\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 124\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, \"^L(5[69]|80)[0-9]{2}$\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 124\n```\n\n\n:::\n\n```{.r .cell-code}\nbench::mark(\n  raw = sf_extract(hcpcs, \"^L56|^L59|^L80\"),\n  compact = sf_extract(hcpcs, \"^L(5[69]|80)[0-9]{2}$\"),\n  iterations = 10000) |> \n  select(expression:total_time)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n  expression      min   median `itr/sec` mem_alloc `gc/sec`\n  <bch:expr> <bch:tm> <bch:tm>     <dbl> <bch:byt>    <dbl>\n1 raw           440µs    526µs     1777.     149KB     5.71\n2 compact       436µs    516µs     1887.     149KB     6.06\n```\n\n\n:::\n:::\n\n\n\n\n### Case 2\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlist(c(\"021\", \"022\", \"026\", \"027\"), \n     c(\"032\", \"033\"), \n     c(\"042\", \"044\"), \n     \"050\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"021\" \"022\" \"026\" \"027\"\n\n[[2]]\n[1] \"032\" \"033\"\n\n[[3]]\n[1] \"042\" \"044\"\n\n[[4]]\n[1] \"050\"\n```\n\n\n:::\n\n```{.r .cell-code}\nbench::mark(\n  raw = sf_extract(hcpcs, \"^021|^022|^026|^027|^032|^033|^042|^044|^050\"),\n  compact = sf_extract(hcpcs, sf_convert(\"^0(2[1267]|3[23]|4[24]|50)[A-Z0-9]{2}$\")),\n  iterations = 10000) |> \n  select(expression:total_time)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n  expression      min   median `itr/sec` mem_alloc `gc/sec`\n  <bch:expr> <bch:tm> <bch:tm>     <dbl> <bch:byt>    <dbl>\n1 raw           480µs    557µs     1765.     149KB     5.49\n2 compact       453µs    535µs     1841.     149KB     5.35\n```\n\n\n:::\n:::\n\n\n\n\n### Case 3\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlist(c(\"C75\", \"C97\"),\n     c(\"G02\", \"G04\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"C75\" \"C97\"\n\n[[2]]\n[1] \"G02\" \"G04\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, \"^C75|^C97|^G02|^G04\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 253\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, \"^C(75|97)[0-9]{2}$|^G0[24][0-9]{2}$\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 253\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, \"^(C(75|97)|G0[24])[0-9]{2}$\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 253\n```\n\n\n:::\n\n```{.r .cell-code}\nbench::mark(\n  raw = sf_extract(hcpcs, \"^C75|^C97|^G02|^G04\"),\n  reduced = sf_extract(hcpcs, \"^C(75|97)[0-9]{2}$|^G0[24][0-9]{2}$\"),\n  compact = sf_extract(hcpcs, sf_convert(\"^(C(75|97)|G0[24])[0-9]{2}$\")),\n  iterations = 10000) |> \n  select(expression:total_time)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 6\n  expression      min   median `itr/sec` mem_alloc `gc/sec`\n  <bch:expr> <bch:tm> <bch:tm>     <dbl> <bch:byt>    <dbl>\n1 raw           491µs    570µs     1731.     151KB     5.21\n2 reduced       475µs    557µs     1772.     151KB     5.33\n3 compact       488µs    557µs     1770.     151KB     5.33\n```\n\n\n:::\n:::\n\n\n\n\n### Case 4\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlist(\"0[2-5]\", \n     \"15\", \n     \"2[027]\", \n     \"3[0-24-6]\", \n     \"5[0458]\", \n     \"6[134]\", \n     \"76\", \n     \"9[25]\", \n     \"C[79]\", \n     \"E0\", \n     \"G0\", \n     \"S2\") -> c4list\n\nc4list\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"0[2-5]\"\n\n[[2]]\n[1] \"15\"\n\n[[3]]\n[1] \"2[027]\"\n\n[[4]]\n[1] \"3[0-24-6]\"\n\n[[5]]\n[1] \"5[0458]\"\n\n[[6]]\n[1] \"6[134]\"\n\n[[7]]\n[1] \"76\"\n\n[[8]]\n[1] \"9[25]\"\n\n[[9]]\n[1] \"C[79]\"\n\n[[10]]\n[1] \"E0\"\n\n[[11]]\n[1] \"G0\"\n\n[[12]]\n[1] \"S2\"\n```\n\n\n:::\n\n```{.r .cell-code}\nc4raw <- \"^02|^03|^04|^05|^15|^20|^22|^27|^30|^31|^32|^34|^35|^36|^50|^54|^55|^58|^61|^63|^64|^76|^92|^95|^C7|^C9|^E0|^G0|^S2\"\n\nc4compact <- paste0(\"^(\", sf_collapse(list_c(c4list), collapse = \"|\"), \")[A-Z0-9]{3}$\")\n\nlength(sf_extract(hcpcs, c4raw))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4349\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, c4compact))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4349\n```\n\n\n:::\n\n```{.r .cell-code}\nbench::mark(\n  raw = sf_extract(hcpcs, c4raw),\n  compact = sf_extract(hcpcs, c4compact),\n  iterations = 10000) |> \n  select(expression:total_time)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n  expression      min   median `itr/sec` mem_alloc `gc/sec`\n  <bch:expr> <bch:tm> <bch:tm>     <dbl> <bch:byt>    <dbl>\n1 raw          2.01ms   2.47ms      401.     199KB     1.61\n2 compact      1.26ms    1.5ms      651.     199KB     2.62\n```\n\n\n:::\n:::\n\n\n\n\n::: \n\n\n\n\n{{< pagebreak >}}\n\n\n\n\n\n\n# Preprocess Steps\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nview <- \\(x) {\n  \n  idx  <- format(seq_along(x))\n  len  <- format(vlen(x), justify = \"left\")\n  tree <- format(unname(map_vec(x, paste0, collapse = \" \")), justify = \"none\")\n  \n  msg <- glue::glue(\n      \"{idx}: \",\n      \"{len}|\",\n      \"--[{if (empty(tree)) NULL else tree}]\"\n      )\n  \n  cli::cat_bullet(msg)\n  \n  return(invisible(x))\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nx <- random_hcpcs()\n\nx |> \n  split_lengths() |> \n  view()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n• 1:  1|--[C]\n• 2: 10|--[04 30 36 41 42 46 58 64 G0 G9]\n• 3: 10|--[267 327 741 743 880 A62 J24 M12 T10 V51]\n• 4: 10|--[0248 2747 4326 4382 6446 A456 J254 L567 M130 Q049]\n• 5: 10|--[0074U 0306U 12016 28119 33400 67108 76098 82491 90964 E1039]\n```\n\n\n:::\n\n```{.r .cell-code}\nx |>\n  split_lengths() |> \n  remove_redundant() |>\n  view()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n• 1:  1|--[C]\n• 2: 10|--[04 30 36 41 42 46 58 64 G0 G9]\n• 3: 10|--[267 327 741 743 880 A62 J24 M12 T10 V51]\n• 4:  9|--[0248 2747 4326 4382 A456 J254 L567 M130 Q049]\n• 5: 10|--[0074U 0306U 12016 28119 33400 67108 76098 82491 90964 E1039]\n```\n\n\n:::\n\n```{.r .cell-code}\nx |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |> \n  view()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n• 1: 1|--[C]\n• 2: 6|--[04 c(\"30\", \"36\") c(\"41\", \"42\", \"46\") 58 64 c(\"G0\", \"G9\")]\n• 3: 9|--[267 327 c(\"741\", \"743\") 880 A62 J24 M12 T10 V51]\n• 4: 8|--[0248 2747 c(\"4326\", \"4382\") A456 J254 L567 M130 Q049]\n• 5: 9|--[12016 28119 33400 67108 76098 82491 90964 E1039 c(\"0074U\", \"0306U\")]\n```\n\n\n:::\n:::\n\n{{< pagebreak >}}\n\n\n\n\n\n\n# Process Groups\n\n::: {.panel-tabset}\n\n## Group 3\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nc(\"C75\", \"C97\", \"G02\", \"G04\") |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"C75\"\n\n[[1]][[2]]\n[1] \"C97\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"G02\" \"G04\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlong_test2[nchar(long_test2) == 3] |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"021\" \"022\" \"026\" \"027\"\n\n[[1]][[2]]\n[1] \"032\" \"033\"\n\n[[1]][[3]]\n[1] \"042\" \"044\"\n\n[[1]][[4]]\n[1] \"050\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"157\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"209\"\n\n[[3]][[2]]\n[1] \"225\"\n\n[[3]][[3]]\n[1] \"271\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"308\"\n\n[[4]][[2]]\n[1] \"312\"\n\n[[4]][[3]]\n[1] \"326\"\n\n[[4]][[4]]\n[1] \"347\" \"348\"\n\n[[4]][[5]]\n[1] \"355\"\n\n[[4]][[6]]\n[1] \"362\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"503\" \"505\"\n\n[[5]][[2]]\n[1] \"544\"\n\n[[5]][[3]]\n[1] \"552\" \"553\"\n\n[[5]][[4]]\n[1] \"585\" \"586\" \"587\" \"588\" \"589\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"610\" \"612\"\n\n[[6]][[2]]\n[1] \"630\"\n\n[[6]][[3]]\n[1] \"644\" \"646\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"765\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"920\" \"921\" \"922\"\n\n[[8]][[2]]\n[1] \"958\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C75\"\n\n[[9]][[2]]\n[1] \"C97\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E06\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G02\" \"G04\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S23\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs() |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"021\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"274\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"351\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"821\"\n\n[[4]][[2]]\n[1] \"866\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"A70\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"E26\"\n```\n\n\n:::\n:::\n\n\n\n\n## Group 4\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nold_group_4 <- function(x) {\n  x <- getelem(x, \"x4\")\n\n  if (empty(x))\n    return(x)\n\n  map(x, function(x) {\n    idx <- data.table(\n      code = x,\n      grp1 = sf_sub(x, 1, 2),\n      grp2 = sf_sub(x, 1, 3),\n      a1 = take_at(x),\n      a2 = take_at(x, 2),\n      a3 = take_at(x, 3),\n      a4 = take_at(x, 4),\n      i1 = groupid(take_at(x))\n    )\n    \n    message(\"Initial data frame\")\n    print(idx)\n    \n    idx <- idx |>\n      fgroup_by(a1) |>\n      fmutate(i2 = groupid(a2)) |>\n      fgroup_by(a1, a2) |>\n      fmutate(i3 = groupid(a3)) |>\n      fgroup_by(a1, a2, a3) |>\n      fmutate(i4 = groupid(a4)) |>\n      fungroup()\n    \n    message(\"Grouped data frame\")\n    print(idx)\n\n    lone <- fcount(idx, i1, add = TRUE) |>\n      fmutate(`i2 + i3 + i4 + N` = i2 + i3 + i4 + N)\n    \n    message(\"Lone Counted\")\n    print(lone)\n    \n    lone <- lone |>\n      fsubset((i2 + i3 + i4 + N) == 4)\n    \n    message(\"Lone i2 + i3 + i4 + N == 4\")\n    print(lone)\n\n    last <- fsubset(idx, code %!in% lone[[\"code\"]])\n    \n    message(\"Last Filtered\")\n    print(last)\n\n    last <- join(\n      fcount(last, grp1, a3),\n      fcount(last, grp1, name = \"G\"),\n      on = \"grp1\",\n      verbose = 0\n    ) |>\n      fsubset(N == G) |>\n      join(\n        last,\n        on = c(\"grp1\", \"a3\"),\n        how = \"right\",\n        verbose = 0\n      )\n    \n    message(\"Last Joined\")\n    print(last)\n    \n    last <- last |>\n      fsubset(not_na(N))\n    \n    message(\"Last Filtered\")\n    print(last)\n\n    rest <- fsubset(idx, code %!in% c(lone[[\"code\"]], last[[\"code\"]]))\n    \n    message(\"Rest Filtered\")\n    print(rest)\n\n    c(\n      if (empty(lone))\n        NULL\n      else\n        list(lone[[\"code\"]]),\n      if (empty(last))\n        NULL\n      else\n        gchop(last[[\"code\"]], last[[\"grp1\"]]),\n      if (empty(rest))\n        NULL\n      else\n        gchop(rest[[\"code\"]], rest[[\"grp2\"]])\n    )\n  })\n}\n\nc(\"C751\", \"C752\", \"C970\", \"G020\", \"G021\", \"G040\") |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  old_group_4()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nInitial data frame\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1\n   <char> <char> <char> <char> <char> <char> <char> <qG>\n1:   C751     C7    C75      C      7      5      1    1\n2:   C752     C7    C75      C      7      5      2    1\n3:   C970     C9    C97      C      9      7      0    1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGrouped data frame\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1    i2    i3    i4\n   <char> <char> <char> <char> <char> <char> <char> <qG> <int> <int> <int>\n1:   C751     C7    C75      C      7      5      1    1     1     1     1\n2:   C752     C7    C75      C      7      5      2    1     1     1     2\n3:   C970     C9    C97      C      9      7      0    1     2     1     1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLone Counted\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1    i2    i3    i4\n   <char> <char> <char> <char> <char> <char> <char> <qG> <int> <int> <int>\n1:   C751     C7    C75      C      7      5      1    1     1     1     1\n2:   C752     C7    C75      C      7      5      2    1     1     1     2\n3:   C970     C9    C97      C      9      7      0    1     2     1     1\n       N i2 + i3 + i4 + N\n   <int>            <int>\n1:     3                6\n2:     3                7\n3:     3                7\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLone i2 + i3 + i4 + N == 4\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEmpty data.table (0 rows and 13 cols): code,grp1,grp2,a1,a2,a3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLast Filtered\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1    i2    i3    i4\n   <char> <char> <char> <char> <char> <char> <char> <qG> <int> <int> <int>\n1:   C751     C7    C75      C      7      5      1    1     1     1     1\n2:   C752     C7    C75      C      7      5      2    1     1     1     2\n3:   C970     C9    C97      C      9      7      0    1     2     1     1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLast Joined\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     grp1     a3     N     G   code   grp2     a1     a2     a4   i1    i2\n   <char> <char> <int> <int> <char> <char> <char> <char> <char> <qG> <int>\n1:     C7      5     2     2   C751    C75      C      7      1    1     1\n2:     C7      5     2     2   C752    C75      C      7      2    1     1\n3:     C9      7     1     1   C970    C97      C      9      0    1     2\n      i3    i4\n   <int> <int>\n1:     1     1\n2:     1     2\n3:     1     1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLast Filtered\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     grp1     a3     N     G   code   grp2     a1     a2     a4   i1    i2\n   <char> <char> <int> <int> <char> <char> <char> <char> <char> <qG> <int>\n1:     C7      5     2     2   C751    C75      C      7      1    1     1\n2:     C7      5     2     2   C752    C75      C      7      2    1     1\n3:     C9      7     1     1   C970    C97      C      9      0    1     2\n      i3    i4\n   <int> <int>\n1:     1     1\n2:     1     2\n3:     1     1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRest Filtered\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEmpty data.table (0 rows and 11 cols): code,grp1,grp2,a1,a2,a3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nInitial data frame\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1\n   <char> <char> <char> <char> <char> <char> <char> <qG>\n1:   G020     G0    G02      G      0      2      0    1\n2:   G021     G0    G02      G      0      2      1    1\n3:   G040     G0    G04      G      0      4      0    1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGrouped data frame\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1    i2    i3    i4\n   <char> <char> <char> <char> <char> <char> <char> <qG> <int> <int> <int>\n1:   G020     G0    G02      G      0      2      0    1     1     1     1\n2:   G021     G0    G02      G      0      2      1    1     1     1     2\n3:   G040     G0    G04      G      0      4      0    1     1     2     1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLone Counted\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1    i2    i3    i4\n   <char> <char> <char> <char> <char> <char> <char> <qG> <int> <int> <int>\n1:   G020     G0    G02      G      0      2      0    1     1     1     1\n2:   G021     G0    G02      G      0      2      1    1     1     1     2\n3:   G040     G0    G04      G      0      4      0    1     1     2     1\n       N i2 + i3 + i4 + N\n   <int>            <int>\n1:     3                6\n2:     3                7\n3:     3                7\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLone i2 + i3 + i4 + N == 4\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEmpty data.table (0 rows and 13 cols): code,grp1,grp2,a1,a2,a3...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLast Filtered\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1    i2    i3    i4\n   <char> <char> <char> <char> <char> <char> <char> <qG> <int> <int> <int>\n1:   G020     G0    G02      G      0      2      0    1     1     1     1\n2:   G021     G0    G02      G      0      2      1    1     1     1     2\n3:   G040     G0    G04      G      0      4      0    1     1     2     1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLast Joined\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     grp1     a3     N     G   code   grp2     a1     a2     a4   i1    i2\n   <char> <char> <int> <int> <char> <char> <char> <char> <char> <qG> <int>\n1:     G0      2    NA    NA   G020    G02      G      0      0    1     1\n2:     G0      2    NA    NA   G021    G02      G      0      1    1     1\n3:     G0      4    NA    NA   G040    G04      G      0      0    1     1\n      i3    i4\n   <int> <int>\n1:     1     1\n2:     1     2\n3:     2     1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLast Filtered\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEmpty data.table (0 rows and 13 cols): grp1,a3,N,G,code,grp2...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRest Filtered\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     code   grp1   grp2     a1     a2     a3     a4   i1    i2    i3    i4\n   <char> <char> <char> <char> <char> <char> <char> <qG> <int> <int> <int>\n1:   G020     G0    G02      G      0      2      0    1     1     1     1\n2:   G021     G0    G02      G      0      2      1    1     1     1     2\n3:   G040     G0    G04      G      0      4      0    1     1     2     1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"C751\" \"C752\"\n\n[[1]][[2]]\n[1] \"C970\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"G020\" \"G021\"\n\n[[2]][[2]]\n[1] \"G040\"\n```\n\n\n:::\n:::\n\n\n\n\n## Group 5\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngroup_5_num <- function(x) {\n  \n  map(x, function(x) {\n    \n    idx <- data.table(\n      code = x,\n      grp1 = sf_sub(x, 1, 2),\n      grp2 = sf_sub(x, 1, 3),\n      grp3 = sf_sub(x, 1, 4),\n      a1 = take_at(x),\n      a2 = take_at(x, 2),\n      a3 = take_at(x, 3),\n      a4 = take_at(x, 4),\n      a5 = take_at(x, 5),\n      i1 = groupid(take_at(x))) |>\n      fgroup_by(a1) |> \n      fmutate(i2 = groupid(a2)) |>\n      fgroup_by(a1, a2) |> \n      fmutate(i3 = groupid(a3)) |>\n      fgroup_by(a1, a2, a3) |> \n      fmutate(i4 = groupid(a4)) |>\n      fgroup_by(a1, a2, a3, a4) |> \n      fmutate(i5 = groupid(a5)) |> \n      fungroup()\n\n      lone <- fcount(idx, i1, add = TRUE) |> \n        fsubset((i2 + i3 + i4 + i5 + N) == 5)\n      \n      last <- fsubset(idx, code %!in% lone[[\"code\"]])\n      \n      last <- join(\n        fcount(last, grp2, a4),\n        fcount(last, grp2, name = \"G\"), on = \"grp2\", verbose = 0) |>\n        fsubset(N == G) |>\n        join(last, on = c(\"grp2\", \"a4\"), how = \"right\", verbose = 0) |> \n        fsubset(not_na(N))\n      \n      rest <- fsubset(idx, code %!in% c(lone[[\"code\"]], last[[\"code\"]]))\n      \n      c(if (empty(lone)) NULL else list(lone[[\"code\"]]),\n        if (empty(last)) NULL else gchop(last[[\"code\"]], last[[\"grp2\"]]),\n        if (empty(rest)) NULL else gchop(rest[[\"code\"]], rest[[\"grp3\"]]))\n    })\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngroup_5_chr <- function(x) {\n  \n  original <- x\n  \n  reversed <- map(original, \\(x) paste0(take_at(x, 5), sf_remove(x, \"[A-Z]$\")))\n\n  map2(reversed, original, function(x, y) {\n    \n    idx <- data.table(\n      orig = y,\n      code = x,\n      grp1 = sf_sub(x, 1, 2),\n      grp2 = sf_sub(x, 1, 3),\n      grp3 = sf_sub(x, 1, 4),\n      a1 = take_at(x),\n      a2 = take_at(x, 2),\n      a3 = take_at(x, 3),\n      a4 = take_at(x, 4),\n      a5 = take_at(x, 5),\n      i1 = groupid(take_at(x))) |>\n      fgroup_by(a1) |> \n      fmutate(i2 = groupid(a2)) |>\n      fgroup_by(a1, a2) |> \n      fmutate(i3 = groupid(a3)) |>\n      fgroup_by(a1, a2, a3) |> \n      fmutate(i4 = groupid(a4)) |>\n      fgroup_by(a1, a2, a3, a4) |> \n      fmutate(i5 = groupid(a5)) |> \n      fungroup()\n\n      lone <- fcount(idx, i1, add = TRUE) |> \n        fsubset((i2 + i3 + i4 + i5 + N) == 5)\n      \n      last <- fsubset(idx, code %!in% lone[[\"code\"]])\n      \n      last <- join(\n        fcount(last, grp2, a4),\n        fcount(last, grp2, name = \"G\"), on = \"grp2\", verbose = 0) |>\n        fsubset(N == G) |>\n        join(last, on = c(\"grp2\", \"a4\"), how = \"right\", verbose = 0) |> \n        fsubset(not_na(N))\n      \n      rest <- fsubset(idx, code %!in% c(lone[[\"code\"]], last[[\"code\"]]))\n\n    c(\n      if (empty(lone))\n        NULL\n      else\n        list(lone[[\"orig\"]]),\n      if (empty(last))\n        NULL\n      else\n        gchop(last[[\"orig\"]], last[[\"grp1\"]]),\n      if (empty(rest))\n        NULL\n      else\n        gchop(rest[[\"orig\"]], rest[[\"grp2\"]])\n    )\n  })\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngroup_5 <- function(x) {\n\n  x <- getelem(x, \"x5\")\n\n  if (empty(x)) return(x)\n  \n  chr <- map(x, \\(x) sf_extract(x, \"[A-Z]$\")) |> compact()\n  num <- map(x, \\(x) sf_extract(x, \"[0-9]$\")) |> compact()\n\n  c(\n    if (empty(chr)) NULL else group_5_chr(chr),\n    if (empty(num)) NULL else group_5_num(num)\n  )\n}\n\n\nc(\"C7510\", \"C9701\", \"G0200\", \"G0400\") |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"C7510\"\n\n[[1]][[2]]\n[1] \"C9701\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"G0200\"\n\n[[2]][[2]]\n[1] \"G0400\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlong_test2[nchar(long_test2) == 5] |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"0506T\" \"0507T\"\n\n[[1]][[2]]\n [1] \"0214T\" \"0215T\" \"0217T\" \"0218T\" \"0219T\" \"0220T\" \"0221T\" \"0222T\" \"0263T\"\n[10] \"0265T\" \"0266T\" \"0269T\" \"0274T\" \"0275T\"\n\n[[1]][[3]]\n[1] \"0329T\" \"0330T\"\n\n[[1]][[4]]\n[1] \"0422T\" \"0444T\" \"0445T\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"15777\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"20939\"\n\n[[3]][[2]]\n[1] \"27197\" \"27198\"\n\n[[3]][[3]]\n[1] \"22510\" \"22511\" \"22512\" \"22513\" \"22514\" \"22515\"\n\n[[3]][[4]]\n[1] \"22526\" \"22527\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"30801\" \"30802\"\n\n[[4]][[2]]\n[1] \"31231\"\n\n[[4]][[3]]\n[1] \"32673\"\n\n[[4]][[4]]\n[1] \"34713\" \"34714\" \"34715\" \"34716\" \"34717\"\n\n[[4]][[5]]\n[1] \"35572\"\n\n[[4]][[6]]\n[1] \"36221\"\n\n[[4]][[7]]\n[1] \"34812\"\n\n[[4]][[8]]\n[1] \"34820\"\n\n[[4]][[9]]\n[1] \"34833\" \"34834\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"50300\"\n\n[[5]][[2]]\n[1] \"50540\"\n\n[[5]][[3]]\n[1] \"55300\"\n\n[[5]][[4]]\n[1] \"58575\"\n\n[[5]][[5]]\n[1] \"58600\" \"58605\"\n\n[[5]][[6]]\n[1] \"58800\" \"58805\"\n\n[[5]][[7]]\n[1] \"54420\"\n\n[[5]][[8]]\n[1] \"54430\"\n\n[[5]][[9]]\n[1] \"55200\"\n\n[[5]][[10]]\n[1] \"55250\"\n\n[[5]][[11]]\n[1] \"58700\"\n\n[[5]][[12]]\n[1] \"58720\"\n\n[[5]][[13]]\n[1] \"58900\"\n\n[[5]][[14]]\n[1] \"58920\" \"58925\"\n\n[[5]][[15]]\n[1] \"58940\" \"58943\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"61000\" \"61001\"\n\n[[6]][[2]]\n[1] \"61253\"\n\n[[6]][[3]]\n[1] \"64634\" \"64636\"\n\n[[6]][[4]]\n[1] \"63035\"\n\n[[6]][[5]]\n[1] \"63043\" \"63044\" \"63045\" \"63046\" \"63047\" \"63048\"\n\n[[6]][[6]]\n[1] \"64421\"\n\n[[6]][[7]]\n[1] \"64480\" \"64484\"\n\n[[6]][[8]]\n[1] \"64491\" \"64492\" \"64494\" \"64495\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"76514\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"95870\"\n\n[[8]][[2]]\n[1] \"92025\"\n\n[[8]][[3]]\n[1] \"92081\" \"92082\" \"92083\"\n\n[[8]][[4]]\n[1] \"92132\" \"92133\" \"92134\"\n\n[[8]][[5]]\n[1] \"92145\"\n\n[[8]][[6]]\n[1] \"92201\" \"92202\"\n\n[[8]][[7]]\n[1] \"92227\" \"92228\" \"92229\"\n\n[[8]][[8]]\n[1] \"92235\"\n\n[[8]][[9]]\n[1] \"92240\" \"92242\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C7501\" \"C7502\" \"C7504\" \"C7505\"\n\n[[9]][[2]]\n[1] \"C9771\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E0675\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G0279\"\n\n[[11]][[2]]\n[1] \"G0412\" \"G0413\" \"G0414\" \"G0415\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S2342\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs() |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"0248T\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"76978\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"84066\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"93226\"\n\n[[4]][[2]]\n[1] \"95941\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"C1757\"\n\n[[5]][[2]]\n[1] \"C9071\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"G8903\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"L0200\"\n\n[[7]][[2]]\n[1] \"L0458\"\n```\n\n\n:::\n:::\n\n\n\n\n## process_groups\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprocess_groups <- function(x) {\n  \n  list(\n    g1 = x$x1,\n    g2 = x$x2,\n    g3 = group_3(x),\n    g4 = group_4(x),\n    g5 = group_5(x)\n    )\n}\n\nhcpcs_tests |>\n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  process_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$g1\n$g1[[1]]\n[1] \"0\" \"4\" \"5\" \"6\" \"G\" \"J\"\n\n\n$g2\n$g2[[1]]\n[1] \"30\" \"31\" \"32\"\n\n\n$g3\n$g3[[1]]\n$g3[[1]][[1]]\n[1] \"721\" \"722\" \"723\" \"724\" \"725\" \"726\" \"727\" \"728\" \"729\"\n\n\n\n$g4\nlist()\n\n$g5\n$g5[[1]]\n$g5[[1]][[1]]\n[1] \"92015\" \"92016\" \"92017\" \"92018\" \"92019\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlong_test2 |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |> \n  process_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$g1\n$g1[[1]]\n [1] \"0\" \"1\" \"2\" \"3\" \"5\" \"6\" \"7\" \"9\" \"C\" \"E\" \"G\" \"S\"\n\n\n$g2\nlist()\n\n$g3\nlist()\n\n$g4\nlist()\n\n$g5\nlist()\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(50) |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  process_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$g1\n$g1[[1]]\n[1] \"A\" \"G\" \"P\"\n\n\n$g2\n$g2[[1]]\n[1] \"02\" \"03\" \"06\"\n\n$g2[[2]]\n[1] \"22\" \"23\" \"24\" \"26\" \"28\" \"29\"\n\n$g2[[3]]\n[1] \"32\" \"36\"\n\n$g2[[4]]\n[1] \"43\" \"44\"\n\n$g2[[5]]\n[1] \"59\"\n\n$g2[[6]]\n[1] \"62\" \"63\" \"64\"\n\n$g2[[7]]\n[1] \"72\" \"73\" \"74\" \"76\"\n\n$g2[[8]]\n[1] \"86\" \"87\"\n\n$g2[[9]]\n[1] \"92\" \"95\" \"96\" \"99\"\n\n$g2[[10]]\n[1] \"C9\"\n\n$g2[[11]]\n[1] \"E0\" \"E2\"\n\n$g2[[12]]\n[1] \"J2\"\n\n$g2[[13]]\n[1] \"Q4\"\n\n$g2[[14]]\n[1] \"S3\"\n\n\n$g3\n$g3[[1]]\n$g3[[1]][[1]]\n[1] \"010\" \"015\"\n\n\n$g3[[2]]\n$g3[[2]][[1]]\n[1] \"275\"\n\n\n$g3[[3]]\n$g3[[3]][[1]]\n[1] \"316\"\n\n$g3[[3]][[2]]\n[1] \"351\"\n\n$g3[[3]][[3]]\n[1] \"372\"\n\n\n$g3[[4]]\n$g3[[4]][[1]]\n[1] \"411\" \"415\"\n\n$g3[[4]][[2]]\n[1] \"453\" \"455\"\n\n\n$g3[[5]]\n$g3[[5]][[1]]\n[1] \"615\"\n\n$g3[[5]][[2]]\n[1] \"658\"\n\n$g3[[5]][[3]]\n[1] \"699\"\n\n\n$g3[[6]]\n$g3[[6]][[1]]\n[1] \"827\"\n\n$g3[[6]][[2]]\n[1] \"883\"\n\n\n$g3[[7]]\n$g3[[7]][[1]]\n[1] \"C89\"\n\n\n$g3[[8]]\n$g3[[8]][[1]]\n[1] \"J05\"\n\n$g3[[8]][[2]]\n[1] \"J18\"\n\n$g3[[8]][[3]]\n[1] \"J92\" \"J99\"\n\n\n$g3[[9]]\n$g3[[9]][[1]]\n[1] \"K08\"\n\n$g3[[9]][[2]]\n[1] \"K10\"\n\n\n$g3[[10]]\n$g3[[10]][[1]]\n[1] \"L36\"\n\n$g3[[10]][[2]]\n[1] \"L41\"\n\n\n$g3[[11]]\n$g3[[11]][[1]]\n[1] \"M12\"\n\n\n$g3[[12]]\n$g3[[12]][[1]]\n[1] \"Q51\"\n\n\n$g3[[13]]\n$g3[[13]][[1]]\n[1] \"T45\"\n\n\n\n$g4\n$g4[[1]]\n$g4[[1]][[1]]\n[1] \"1908\"\n\n\n$g4[[2]]\n$g4[[2]][[1]]\n[1] \"2060\"\n\n$g4[[2]][[2]]\n[1] \"2192\"\n\n$g4[[2]][[3]]\n[1] \"2781\"\n\n\n$g4[[3]]\n$g4[[3]][[1]]\n[1] \"3360\"\n\n$g4[[3]][[2]]\n[1] \"3483\"\n\n\n$g4[[4]]\n$g4[[4]][[1]]\n[1] \"4906\"\n\n\n$g4[[5]]\n$g4[[5]][[1]]\n[1] \"6837\"\n\n\n$g4[[6]]\n$g4[[6]][[1]]\n[1] \"7049\"\n\n$g4[[6]][[2]]\n[1] \"7589\"\n\n\n$g4[[7]]\n$g4[[7]][[1]]\n[1] \"8117\"\n\n$g4[[7]][[2]]\n[1] \"8541\"\n\n\n$g4[[8]]\n$g4[[8]][[1]]\n[1] \"9359\"\n\n$g4[[8]][[2]]\n[1] \"9363\"\n\n\n$g4[[9]]\n$g4[[9]][[1]]\n[1] \"C187\"\n\n\n$g4[[10]]\n$g4[[10]][[1]]\n[1] \"H101\"\n\n\n$g4[[11]]\n$g4[[11]][[1]]\n[1] \"L097\"\n\n$g4[[11]][[2]]\n[1] \"L338\"\n\n$g4[[11]][[3]]\n[1] \"L585\"\n\n$g4[[11]][[4]]\n[1] \"L670\"\n\n\n$g4[[12]]\n$g4[[12]][[1]]\n[1] \"Q050\"\n\n\n$g4[[13]]\n$g4[[13]][[1]]\n[1] \"S932\"\n\n\n$g4[[14]]\n$g4[[14]][[1]]\n[1] \"V533\"\n\n\n\n$g5\n$g5[[1]]\n$g5[[1]][[1]]\n[1] \"2021F\"\n\n\n$g5[[2]]\n$g5[[2]][[1]]\n[1] \"3500F\" \"3572F\"\n\n\n$g5[[3]]\n$g5[[3]][[1]]\n[1] \"0749T\"\n\n\n$g5[[4]]\n$g5[[4]][[1]]\n[1] \"17262\"\n\n\n$g5[[5]]\n$g5[[5]][[1]]\n[1] \"25391\"\n\n$g5[[5]][[2]]\n[1] \"25652\"\n\n$g5[[5]][[3]]\n[1] \"27499\"\n\n\n$g5[[6]]\n$g5[[6]][[1]]\n[1] \"33641\"\n\n$g5[[6]][[2]]\n[1] \"37718\"\n\n\n$g5[[7]]\n$g5[[7]][[1]]\n[1] \"47133\"\n\n\n$g5[[8]]\n$g5[[8]][[1]]\n[1] \"50593\"\n\n$g5[[8]][[2]]\n[1] \"54512\"\n\n\n$g5[[9]]\n$g5[[9]][[1]]\n[1] \"65710\"\n\n$g5[[9]][[2]]\n[1] \"67560\"\n\n$g5[[9]][[3]]\n[1] \"69646\"\n\n\n$g5[[10]]\n$g5[[10]][[1]]\n[1] \"77055\"\n\n$g5[[10]][[2]]\n[1] \"78191\"\n\n$g5[[10]][[3]]\n[1] \"78271\"\n\n\n$g5[[11]]\n$g5[[11]][[1]]\n[1] \"81222\"\n\n$g5[[11]][[2]]\n[1] \"81422\"\n\n$g5[[11]][[3]]\n[1] \"84110\"\n\n$g5[[11]][[4]]\n[1] \"85549\"\n\n\n$g5[[12]]\n$g5[[12]][[1]]\n[1] \"97165\"\n\n$g5[[12]][[2]]\n[1] \"93615\"\n\n$g5[[12]][[3]]\n[1] \"93654\"\n\n\n$g5[[13]]\n$g5[[13]][[1]]\n[1] \"K0745\"\n\n\n$g5[[14]]\n$g5[[14]][[1]]\n[1] \"L3420\"\n\n$g5[[14]][[2]]\n[1] \"L5631\"\n\n\n$g5[[15]]\n$g5[[15]][[1]]\n[1] \"S0311\"\n\n$g5[[15]][[2]]\n[1] \"S0390\"\n```\n\n\n:::\n:::\n\n\n\n\n::: \n\n\n\n\n\n{{< pagebreak >}}\n\n\n\n\n\n\n# Reduce Groups\n\n::: {.panel-tabset}\n\n## reduce_runs\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreduce_runs <- function(x) {\n  \n  if (sf_nchar(x) == 1) \n    return(x)\n\n  test <- setNames(rep(0, 37), c(0:9, \"&\", LETTERS))\n  \n  vec <- test[c(desplit(x), \"&\")]\n  \n  vec <- vec[not_na(vec)]\n  \n  test[names(vec)] <- 1\n  \n  test[names(test) == \"&\"] <- 0\n\n  groups <- data.table(\n    value = names(test),\n    keys = test,\n    group = groupid(test)) |>\n    fgroup_by(group)\n  \n  groups <- join(\n    groups, \n    fcount(groups, group), \n    on = \"group\", \n    verbose = 0) |> \n    fungroup() |> \n    fsubset(keys == 1) |>\n    fsubset(N >= 3) |>\n    fselect(value, group)\n    \n  if (empty(groups)) \n    return(x)\n  \n  xgroups <- gchop(\n    groups$value, \n    groups$group) |>\n    map(smush) |>\n    list_c()\n  \n  if (all(xgroups == smush(c(0:9, \"&\", LETTERS)))) \n    return(\"[A-Z0-9]\")\n  \n  replacements <- join(\n    dplyr::slice_min(groups, by = group, order_by = value) |> dplyr::rename(start = value),\n    dplyr::slice_max(groups, by = group, order_by = value) |> dplyr::rename(end = value),\n    on = \"group\", verbose = 0) |>\n    stringr::str_glue_data(\"{start}-{end}\") |>\n    as.vector()\n\n  bracket(replace_regex(x, xgroups, replacements))\n}\n```\n:::\n\n\n\n\n## red1\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred1 <- function(x) {\n  \n  x <- getelem(x, \"g1\")[[1]]\n  \n  if (empty(x)) \n    return(character(0))\n  \n  re <- sort_order(x) |> \n    reduce_runs()\n  \n  if (re == \"[A-Z0-9]\") \n    return(str_glue(\"^{re}{{5}}\"))\n  \n  post <- iif_else(\n    sf_detect(\n      re, \n      \"\\\\[?[0-9]{1}\"), \n    \"[A-Z0-9]\", \n    \"[0-9]\")\n  \n  str_glue(\"^{re}{post}{{4}}\")\n}\n\nlong_test2 |>\n  split_lengths() |> \n  remove_redundant() |> \n  split_first() |>\n  process_groups() |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n^[CEGS0-35-79][A-Z0-9]{4}\n```\n\n\n:::\n\n```{.r .cell-code}\nhcpcs_tests |> \n  split_lengths() |> \n  remove_redundant() |> \n  split_first() |>\n  process_groups() |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n^[GJ04-6][A-Z0-9]{4}\n```\n\n\n:::\n\n```{.r .cell-code}\nc(LETTERS[1:5], 0:9) |> \n  split_lengths() |> \n  remove_redundant() |> \n  split_first() |>\n  process_groups() |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n^[A-E0-9][A-Z0-9]{4}\n```\n\n\n:::\n\n```{.r .cell-code}\nlist(g1 = list(c(0:9, LETTERS))) |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n^[A-Z0-9]{5}\n```\n\n\n:::\n\n```{.r .cell-code}\nlist(g1 = list(c(LETTERS[1:5], 0:9))) |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n^[A-E0-9][A-Z0-9]{4}\n```\n\n\n:::\n:::\n\n\n\n\n## red2\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred2 <- function(x) {\n  \n  x <- getelem(x, \"g2\")\n  \n  if (empty(x)) \n    return(character(0))\n  \n  modify_if(x, len_gt_one, function(x) {\n    \n    parts <- split_max_vlen(x) |> \n    as.data.frame() |>\n    map(uniq_narm) |>\n    map(sort_order) |>\n    map(reduce_runs) |>\n    delist()\n\n  multi <- sf_nchar(parts) > 1\n  nobrk <- sf_ndetect(parts[multi], \"\\\\[|\\\\]\")\n  \n  parts[multi] <- if (any(nobrk)) map_chr(parts[multi], bracket) else parts[multi]\n\n  # if (any(nobrk)) {\n  #   parts[multi] <- map_chr(parts[multi], bracket)\n  # }\n  \n  smush(parts)\n  })\n}\n\nlong_test2[sf_nchar(long_test2) == 2] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  red2()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"0[2-5]\"\n\n[[2]]\n[1] \"15\"\n\n[[3]]\n[1] \"2[027]\"\n\n[[4]]\n[1] \"3[0-24-6]\"\n\n[[5]]\n[1] \"5[0458]\"\n\n[[6]]\n[1] \"6[134]\"\n\n[[7]]\n[1] \"76\"\n\n[[8]]\n[1] \"9[25]\"\n\n[[9]]\n[1] \"C[79]\"\n\n[[10]]\n[1] \"E0\"\n\n[[11]]\n[1] \"G0\"\n\n[[12]]\n[1] \"S2\"\n```\n\n\n:::\n\n```{.r .cell-code}\npaste0(\"A\", c(0:5, LETTERS)) |> \n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  red2()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"A[A-Z0-5]\"\n```\n\n\n:::\n:::\n\n\n\n\n## red3\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred3 <- function(x) {\n  \n  x <- getelem(x, \"g3\")\n  \n  if (empty(x)) return(character(0))\n  \n  map(x, function(x) {\n    \n    modify_if(x, len_gt_one, function(x) {\n      \n      parts <- split_max_vlen(x) |> \n        as.data.frame() |>\n        map(uniq_narm) |> \n        map(sort_order) |>\n        map(reduce_runs) |> \n        delist()\n      \n      multi <- sf_nchar(parts) > 1\n      nobrk <- !sf_detect(parts[multi], \"\\\\[|\\\\]\")\n      \n      if (any(nobrk)) parts[multi] <- map_chr(parts[multi], bracket)\n      \n      smush(parts)\n    })\n  })\n}\n\nlong_test2[sf_nchar(long_test2) == 3] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  red3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"02[1267]\"\n\n[[1]][[2]]\n[1] \"03[23]\"\n\n[[1]][[3]]\n[1] \"04[24]\"\n\n[[1]][[4]]\n[1] \"050\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"157\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"209\"\n\n[[3]][[2]]\n[1] \"225\"\n\n[[3]][[3]]\n[1] \"271\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"308\"\n\n[[4]][[2]]\n[1] \"312\"\n\n[[4]][[3]]\n[1] \"326\"\n\n[[4]][[4]]\n[1] \"34[78]\"\n\n[[4]][[5]]\n[1] \"355\"\n\n[[4]][[6]]\n[1] \"362\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"50[35]\"\n\n[[5]][[2]]\n[1] \"544\"\n\n[[5]][[3]]\n[1] \"55[23]\"\n\n[[5]][[4]]\n[1] \"58[5-9]\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"61[02]\"\n\n[[6]][[2]]\n[1] \"630\"\n\n[[6]][[3]]\n[1] \"64[46]\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"765\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"92[0-2]\"\n\n[[8]][[2]]\n[1] \"958\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C75\"\n\n[[9]][[2]]\n[1] \"C97\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E06\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G0[24]\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S23\"\n```\n\n\n:::\n:::\n\n\n\n\n## red4\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred4 <- function(x) {\n  \n  x <- getelem(x, \"g4\")\n  \n  if (empty(x)) \n    return(character(0))\n  \n  map(x, function(x) {\n    \n    modify_if(x, len_gt_one, function(x) {\n      \n      parts <- split_max_vlen(x) |> \n        as.data.frame() |>\n        map(uniq_narm) |> \n        map(sort_order) |>\n        map(reduce_runs) |> \n        delist()\n      \n      multi <- sf_nchar(parts) > 1\n      nobrk <- !sf_detect(parts[multi], \"\\\\[|\\\\]\")\n      \n      if (any(nobrk)) {\n        parts[multi] <- map_chr(parts[multi], bracket)\n      }\n      \n      smush(parts)\n    })\n  })\n}\n\nlong_test2[sf_nchar(long_test2) == 4] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  red4()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"050[67]\"\n\n[[1]][[2]]\n[1] \"021[457-9]\"\n\n[[1]][[3]]\n[1] \"022[0-2]\"\n\n[[1]][[4]]\n[1] \"026[3569]\"\n\n[[1]][[5]]\n[1] \"027[45]\"\n\n[[1]][[6]]\n[1] \"0329\"\n\n[[1]][[7]]\n[1] \"0330\"\n\n[[1]][[8]]\n[1] \"0422\"\n\n[[1]][[9]]\n[1] \"044[45]\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"1577\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"2093\"\n\n[[3]][[2]]\n[1] \"225[12]\"\n\n[[3]][[3]]\n[1] \"2719\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"3080\"\n\n[[4]][[2]]\n[1] \"3123\"\n\n[[4]][[3]]\n[1] \"3267\"\n\n[[4]][[4]]\n[1] \"3557\"\n\n[[4]][[5]]\n[1] \"3622\"\n\n[[4]][[6]]\n[1] \"3471\"\n\n[[4]][[7]]\n[1] \"348[1-3]\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"544[23]\"\n\n[[5]][[2]]\n[1] \"5030\"\n\n[[5]][[3]]\n[1] \"5054\"\n\n[[5]][[4]]\n[1] \"552[05]\"\n\n[[5]][[5]]\n[1] \"5530\"\n\n[[5]][[6]]\n[1] \"5857\"\n\n[[5]][[7]]\n[1] \"5860\"\n\n[[5]][[8]]\n[1] \"587[02]\"\n\n[[5]][[9]]\n[1] \"5880\"\n\n[[5]][[10]]\n[1] \"589[024]\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"630[34]\"\n\n[[6]][[2]]\n[1] \"6100\"\n\n[[6]][[3]]\n[1] \"6125\"\n\n[[6]][[4]]\n[1] \"644[289]\"\n\n[[6]][[5]]\n[1] \"6463\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"7651\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"9587\"\n\n[[8]][[2]]\n[1] \"920[28]\"\n\n[[8]][[3]]\n[1] \"921[34]\"\n\n[[8]][[4]]\n[1] \"922[02-4]\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C750\"\n\n[[9]][[2]]\n[1] \"C977\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E067\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G027\"\n\n[[11]][[2]]\n[1] \"G041\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S234\"\n```\n\n\n:::\n:::\n\n\n\n\n## red5\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred5 <- function(x) {\n  \n  x <- getelem(x, \"g5\")\n  \n  if (empty(x)) \n    return(character(0))\n  \n  map(x, function(x) {\n    \n    modify_if(x, len_gt_one, function(x) {\n      \n      parts <- split_max_vlen(x) |> \n        as.data.frame() |>\n        map(uniq_narm) |> \n        map(sort_order) |>\n        map(reduce_runs) |> \n        delist()\n      \n      multi <- sf_nchar(parts) > 1\n      nobrk <- sf_ndetect(parts[multi], \"\\\\[|\\\\]\")\n      \n      if (any(nobrk)) {\n        parts[multi] <- map_chr(parts[multi], bracket)\n      }\n      smush(parts)\n    })\n  })\n}\n\nlong_test2[sf_nchar(long_test2) == 5] |>\n  split_lengths() |>\n  # remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  red5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"050[67]T\"\n\n[[1]][[2]]\n[1] \"02[1267][[0-9]]T\"\n\n[[1]][[3]]\n[1] \"03[23][09]T\"\n\n[[1]][[4]]\n[1] \"04[24][245]T\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"15777\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"20939\"\n\n[[3]][[2]]\n[1] \"2719[78]\"\n\n[[3]][[3]]\n[1] \"2251[0-5]\"\n\n[[3]][[4]]\n[1] \"2252[67]\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"3080[12]\"\n\n[[4]][[2]]\n[1] \"31231\"\n\n[[4]][[3]]\n[1] \"32673\"\n\n[[4]][[4]]\n[1] \"3471[3-7]\"\n\n[[4]][[5]]\n[1] \"35572\"\n\n[[4]][[6]]\n[1] \"36221\"\n\n[[4]][[7]]\n[1] \"34812\"\n\n[[4]][[8]]\n[1] \"34820\"\n\n[[4]][[9]]\n[1] \"3483[34]\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"50300\"\n\n[[5]][[2]]\n[1] \"50540\"\n\n[[5]][[3]]\n[1] \"55300\"\n\n[[5]][[4]]\n[1] \"58575\"\n\n[[5]][[5]]\n[1] \"5860[05]\"\n\n[[5]][[6]]\n[1] \"5880[05]\"\n\n[[5]][[7]]\n[1] \"54420\"\n\n[[5]][[8]]\n[1] \"54430\"\n\n[[5]][[9]]\n[1] \"55200\"\n\n[[5]][[10]]\n[1] \"55250\"\n\n[[5]][[11]]\n[1] \"58700\"\n\n[[5]][[12]]\n[1] \"58720\"\n\n[[5]][[13]]\n[1] \"58900\"\n\n[[5]][[14]]\n[1] \"5892[05]\"\n\n[[5]][[15]]\n[1] \"5894[03]\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"6100[01]\"\n\n[[6]][[2]]\n[1] \"61253\"\n\n[[6]][[3]]\n[1] \"6463[46]\"\n\n[[6]][[4]]\n[1] \"63035\"\n\n[[6]][[5]]\n[1] \"6304[3-8]\"\n\n[[6]][[6]]\n[1] \"64421\"\n\n[[6]][[7]]\n[1] \"6448[04]\"\n\n[[6]][[8]]\n[1] \"6449[1245]\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"76514\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"95870\"\n\n[[8]][[2]]\n[1] \"92025\"\n\n[[8]][[3]]\n[1] \"9208[1-3]\"\n\n[[8]][[4]]\n[1] \"9213[2-4]\"\n\n[[8]][[5]]\n[1] \"92145\"\n\n[[8]][[6]]\n[1] \"9220[12]\"\n\n[[8]][[7]]\n[1] \"9222[7-9]\"\n\n[[8]][[8]]\n[1] \"92235\"\n\n[[8]][[9]]\n[1] \"9224[02]\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C750[1245]\"\n\n[[9]][[2]]\n[1] \"C9771\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E0675\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G0279\"\n\n[[11]][[2]]\n[1] \"G041[2-5]\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S2342\"\n```\n\n\n:::\n:::\n\n\n\n\n## reduce_groups\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreduce_groups <- \\(x) {\n  \n  list(\n    g1 = red1(x),\n    g2 = red2(x),\n    g3 = red3(x),\n    g4 = red4(x),\n    g5 = red5(x)\n  )\n}\n\nlong_test2 |>\n  split_lengths() |>\n  # remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  reduce_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$g1\n^[CEGS0-35-79][A-Z0-9]{4}\n\n$g2\n$g2[[1]]\n[1] \"0[2-5]\"\n\n$g2[[2]]\n[1] \"15\"\n\n$g2[[3]]\n[1] \"2[027]\"\n\n$g2[[4]]\n[1] \"3[0-24-6]\"\n\n$g2[[5]]\n[1] \"5[0458]\"\n\n$g2[[6]]\n[1] \"6[134]\"\n\n$g2[[7]]\n[1] \"76\"\n\n$g2[[8]]\n[1] \"9[25]\"\n\n$g2[[9]]\n[1] \"C[79]\"\n\n$g2[[10]]\n[1] \"E0\"\n\n$g2[[11]]\n[1] \"G0\"\n\n$g2[[12]]\n[1] \"S2\"\n\n\n$g3\n$g3[[1]]\n$g3[[1]][[1]]\n[1] \"02[1267]\"\n\n$g3[[1]][[2]]\n[1] \"03[23]\"\n\n$g3[[1]][[3]]\n[1] \"04[24]\"\n\n$g3[[1]][[4]]\n[1] \"050\"\n\n\n$g3[[2]]\n$g3[[2]][[1]]\n[1] \"157\"\n\n\n$g3[[3]]\n$g3[[3]][[1]]\n[1] \"209\"\n\n$g3[[3]][[2]]\n[1] \"225\"\n\n$g3[[3]][[3]]\n[1] \"271\"\n\n\n$g3[[4]]\n$g3[[4]][[1]]\n[1] \"308\"\n\n$g3[[4]][[2]]\n[1] \"312\"\n\n$g3[[4]][[3]]\n[1] \"326\"\n\n$g3[[4]][[4]]\n[1] \"34[78]\"\n\n$g3[[4]][[5]]\n[1] \"355\"\n\n$g3[[4]][[6]]\n[1] \"362\"\n\n\n$g3[[5]]\n$g3[[5]][[1]]\n[1] \"50[35]\"\n\n$g3[[5]][[2]]\n[1] \"544\"\n\n$g3[[5]][[3]]\n[1] \"55[23]\"\n\n$g3[[5]][[4]]\n[1] \"58[5-9]\"\n\n\n$g3[[6]]\n$g3[[6]][[1]]\n[1] \"61[02]\"\n\n$g3[[6]][[2]]\n[1] \"630\"\n\n$g3[[6]][[3]]\n[1] \"64[46]\"\n\n\n$g3[[7]]\n$g3[[7]][[1]]\n[1] \"765\"\n\n\n$g3[[8]]\n$g3[[8]][[1]]\n[1] \"92[0-2]\"\n\n$g3[[8]][[2]]\n[1] \"958\"\n\n\n$g3[[9]]\n$g3[[9]][[1]]\n[1] \"C75\"\n\n$g3[[9]][[2]]\n[1] \"C97\"\n\n\n$g3[[10]]\n$g3[[10]][[1]]\n[1] \"E06\"\n\n\n$g3[[11]]\n$g3[[11]][[1]]\n[1] \"G0[24]\"\n\n\n$g3[[12]]\n$g3[[12]][[1]]\n[1] \"S23\"\n\n\n\n$g4\n$g4[[1]]\n$g4[[1]][[1]]\n[1] \"050[67]\"\n\n$g4[[1]][[2]]\n[1] \"021[457-9]\"\n\n$g4[[1]][[3]]\n[1] \"022[0-2]\"\n\n$g4[[1]][[4]]\n[1] \"026[3569]\"\n\n$g4[[1]][[5]]\n[1] \"027[45]\"\n\n$g4[[1]][[6]]\n[1] \"0329\"\n\n$g4[[1]][[7]]\n[1] \"0330\"\n\n$g4[[1]][[8]]\n[1] \"0422\"\n\n$g4[[1]][[9]]\n[1] \"044[45]\"\n\n\n$g4[[2]]\n$g4[[2]][[1]]\n[1] \"1577\"\n\n\n$g4[[3]]\n$g4[[3]][[1]]\n[1] \"2093\"\n\n$g4[[3]][[2]]\n[1] \"225[12]\"\n\n$g4[[3]][[3]]\n[1] \"2719\"\n\n\n$g4[[4]]\n$g4[[4]][[1]]\n[1] \"3080\"\n\n$g4[[4]][[2]]\n[1] \"3123\"\n\n$g4[[4]][[3]]\n[1] \"3267\"\n\n$g4[[4]][[4]]\n[1] \"3557\"\n\n$g4[[4]][[5]]\n[1] \"3622\"\n\n$g4[[4]][[6]]\n[1] \"3471\"\n\n$g4[[4]][[7]]\n[1] \"348[1-3]\"\n\n\n$g4[[5]]\n$g4[[5]][[1]]\n[1] \"544[23]\"\n\n$g4[[5]][[2]]\n[1] \"5030\"\n\n$g4[[5]][[3]]\n[1] \"5054\"\n\n$g4[[5]][[4]]\n[1] \"552[05]\"\n\n$g4[[5]][[5]]\n[1] \"5530\"\n\n$g4[[5]][[6]]\n[1] \"5857\"\n\n$g4[[5]][[7]]\n[1] \"5860\"\n\n$g4[[5]][[8]]\n[1] \"587[02]\"\n\n$g4[[5]][[9]]\n[1] \"5880\"\n\n$g4[[5]][[10]]\n[1] \"589[024]\"\n\n\n$g4[[6]]\n$g4[[6]][[1]]\n[1] \"630[34]\"\n\n$g4[[6]][[2]]\n[1] \"6100\"\n\n$g4[[6]][[3]]\n[1] \"6125\"\n\n$g4[[6]][[4]]\n[1] \"644[289]\"\n\n$g4[[6]][[5]]\n[1] \"6463\"\n\n\n$g4[[7]]\n$g4[[7]][[1]]\n[1] \"7651\"\n\n\n$g4[[8]]\n$g4[[8]][[1]]\n[1] \"9587\"\n\n$g4[[8]][[2]]\n[1] \"920[28]\"\n\n$g4[[8]][[3]]\n[1] \"921[34]\"\n\n$g4[[8]][[4]]\n[1] \"922[02-4]\"\n\n\n$g4[[9]]\n$g4[[9]][[1]]\n[1] \"C750\"\n\n$g4[[9]][[2]]\n[1] \"C977\"\n\n\n$g4[[10]]\n$g4[[10]][[1]]\n[1] \"E067\"\n\n\n$g4[[11]]\n$g4[[11]][[1]]\n[1] \"G027\"\n\n$g4[[11]][[2]]\n[1] \"G041\"\n\n\n$g4[[12]]\n$g4[[12]][[1]]\n[1] \"S234\"\n\n\n\n$g5\n$g5[[1]]\n$g5[[1]][[1]]\n[1] \"050[67]T\"\n\n$g5[[1]][[2]]\n[1] \"02[1267][[0-9]]T\"\n\n$g5[[1]][[3]]\n[1] \"03[23][09]T\"\n\n$g5[[1]][[4]]\n[1] \"04[24][245]T\"\n\n\n$g5[[2]]\n$g5[[2]][[1]]\n[1] \"15777\"\n\n\n$g5[[3]]\n$g5[[3]][[1]]\n[1] \"20939\"\n\n$g5[[3]][[2]]\n[1] \"2719[78]\"\n\n$g5[[3]][[3]]\n[1] \"2251[0-5]\"\n\n$g5[[3]][[4]]\n[1] \"2252[67]\"\n\n\n$g5[[4]]\n$g5[[4]][[1]]\n[1] \"3080[12]\"\n\n$g5[[4]][[2]]\n[1] \"31231\"\n\n$g5[[4]][[3]]\n[1] \"32673\"\n\n$g5[[4]][[4]]\n[1] \"3471[3-7]\"\n\n$g5[[4]][[5]]\n[1] \"35572\"\n\n$g5[[4]][[6]]\n[1] \"36221\"\n\n$g5[[4]][[7]]\n[1] \"34812\"\n\n$g5[[4]][[8]]\n[1] \"34820\"\n\n$g5[[4]][[9]]\n[1] \"3483[34]\"\n\n\n$g5[[5]]\n$g5[[5]][[1]]\n[1] \"50300\"\n\n$g5[[5]][[2]]\n[1] \"50540\"\n\n$g5[[5]][[3]]\n[1] \"55300\"\n\n$g5[[5]][[4]]\n[1] \"58575\"\n\n$g5[[5]][[5]]\n[1] \"5860[05]\"\n\n$g5[[5]][[6]]\n[1] \"5880[05]\"\n\n$g5[[5]][[7]]\n[1] \"54420\"\n\n$g5[[5]][[8]]\n[1] \"54430\"\n\n$g5[[5]][[9]]\n[1] \"55200\"\n\n$g5[[5]][[10]]\n[1] \"55250\"\n\n$g5[[5]][[11]]\n[1] \"58700\"\n\n$g5[[5]][[12]]\n[1] \"58720\"\n\n$g5[[5]][[13]]\n[1] \"58900\"\n\n$g5[[5]][[14]]\n[1] \"5892[05]\"\n\n$g5[[5]][[15]]\n[1] \"5894[03]\"\n\n\n$g5[[6]]\n$g5[[6]][[1]]\n[1] \"6100[01]\"\n\n$g5[[6]][[2]]\n[1] \"61253\"\n\n$g5[[6]][[3]]\n[1] \"6463[46]\"\n\n$g5[[6]][[4]]\n[1] \"63035\"\n\n$g5[[6]][[5]]\n[1] \"6304[3-8]\"\n\n$g5[[6]][[6]]\n[1] \"64421\"\n\n$g5[[6]][[7]]\n[1] \"6448[04]\"\n\n$g5[[6]][[8]]\n[1] \"6449[1245]\"\n\n\n$g5[[7]]\n$g5[[7]][[1]]\n[1] \"76514\"\n\n\n$g5[[8]]\n$g5[[8]][[1]]\n[1] \"95870\"\n\n$g5[[8]][[2]]\n[1] \"92025\"\n\n$g5[[8]][[3]]\n[1] \"9208[1-3]\"\n\n$g5[[8]][[4]]\n[1] \"9213[2-4]\"\n\n$g5[[8]][[5]]\n[1] \"92145\"\n\n$g5[[8]][[6]]\n[1] \"9220[12]\"\n\n$g5[[8]][[7]]\n[1] \"9222[7-9]\"\n\n$g5[[8]][[8]]\n[1] \"92235\"\n\n$g5[[8]][[9]]\n[1] \"9224[02]\"\n\n\n$g5[[9]]\n$g5[[9]][[1]]\n[1] \"C750[1245]\"\n\n$g5[[9]][[2]]\n[1] \"C9771\"\n\n\n$g5[[10]]\n$g5[[10]][[1]]\n[1] \"E0675\"\n\n\n$g5[[11]]\n$g5[[11]][[1]]\n[1] \"G0279\"\n\n$g5[[11]][[2]]\n[1] \"G041[2-5]\"\n\n\n$g5[[12]]\n$g5[[12]][[1]]\n[1] \"S2342\"\n```\n\n\n:::\n:::\n\n\n\n\n::: \n\n\n\n\n{{< pagebreak >}}\n\n\n\n\n\n\n\n# Recombine Vectors\n\n::: {.panel-tabset}\n\n## recombine2\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrecombine2 <- function(x) {\n  \n  x <- getelem(x, \"g2\")\n  \n  if (empty(x)) \n    return(character(0))\n  \n  x <- sf_collapse(list_c(x), collapse = '|')\n  \n  str_glue(\"^({x})[A-Z0-9]{{3}}$\")\n}\n\nlong_test2[sf_nchar(long_test2) == 2] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |> \n  recombine2()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n^(0[2-5]|15|2[027]|3[0-24-6]|5[0458]|6[134]|76|9[25]|C[79]|E0|G0|S2)[A-Z0-9]{3}$\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs() |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |> \n  recombine2()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n^(0[08]|13|26|49|84|L5|Q0|V5)[A-Z0-9]{3}$\n```\n\n\n:::\n:::\n\n\n\n\n## recombine3\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrecombine3 <- function(x) {\n  \n  x <- getelem(x, \"g3\")\n  \n  if (empty(x)) \n    return(character(0))\n  \n  c(\n    if (empty(x[vlen(x) == 1])) character(0) else str_glue(\"{list_c(x[vlen(x) == 1])}\"),\n    \n    if (empty(x[vlen(x) > 1])) \n      character(0) \n    else \n      map(\n        x[vlen(x) > 1], function(x) {\n          \n          front <- uniq(sf_sub(delist(x), start = 1, stop = 1))\n          \n          back  <- sf_collapse(sf_remove(delist(x), str_glue(\"^[{front}]{{1}}\")), collapse = \"|\")\n          \n          str_glue(\"{front}({back})\")\n          })\n    )\n}\n\nlong_test2[sf_nchar(long_test2) == 3] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  reduce_groups() |> \n  recombine3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"157\"\n\n[[2]]\n[1] \"765\"\n\n[[3]]\n[1] \"E06\"\n\n[[4]]\n[1] \"G0[24]\"\n\n[[5]]\n[1] \"S23\"\n\n[[6]]\n0(2[1267]|3[23]|4[24]|50)\n\n[[7]]\n2(09|25|71)\n\n[[8]]\n3(08|12|26|4[78]|55|62)\n\n[[9]]\n5(0[35]|44|5[23]|8[5-9])\n\n[[10]]\n6(1[02]|30|4[46])\n\n[[11]]\n9(2[0-2]|58)\n\n[[12]]\nC(75|97)\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(50) |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |> \n  recombine3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"517\"\n\n[[2]]\n[1] \"613\"\n\n[[3]]\n[1] \"937\"\n\n[[4]]\n[1] \"A95\"\n\n[[5]]\n[1] \"E20\"\n\n[[6]]\n[1] \"J91\"\n\n[[7]]\n[1] \"L66\"\n\n[[8]]\n[1] \"Q50\"\n\n[[9]]\n0(41|7[24])\n\n[[10]]\n1(20|92)\n\n[[11]]\n2(03|12|50)\n\n[[12]]\n3(3[89]|55)\n\n[[13]]\n4(48|95)\n\n[[14]]\n7(02|44|6[19])\n\n[[15]]\n8(2[79]|35)\n```\n\n\n:::\n:::\n\n\n\n\n## recombine4\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrecombine4 <- function(x) {\n  \n  x <- getelem(x, \"g4\")\n  \n  if (empty(x)) \n    return(character(0))\n  \n  c(\n    if (empty(x[vlen(x) == 1])) \n      character(0) \n    else \n      sf_convert(str_glue(\"{list_c(x[vlen(x) == 1])}\")),\n    \n    if (empty(x[vlen(x) > 1])) \n      character(0) \n    else \n      map(\n        x[vlen(x) > 1], function(x) {\n          \n          front <- uniq(sf_sub(delist(x), start = 1, stop = 1))\n          back  <- sf_collapse(sf_remove(delist(x), str_glue(\"^[{front}]{{1}}\")), collapse = \"|\")\n          sf_convert(str_glue(\"{front}({back})\"))\n          }\n        )\n    )\n  }\n\nlong_test2[sf_nchar(long_test2) == 4] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  reduce_groups() |> \n  recombine4()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"1577\"\n\n[[2]]\n[1] \"7651\"\n\n[[3]]\n[1] \"E067\"\n\n[[4]]\n[1] \"S234\"\n\n[[5]]\n[1] \"0(50[67]|21[457-9]|22[0-2]|26[3569]|27[45]|329|330|422|44[45])\"\n\n[[6]]\n[1] \"2(093|25[12]|719)\"\n\n[[7]]\n[1] \"3(080|123|267|557|622|471|48[1-3])\"\n\n[[8]]\n[1] \"5(44[23]|030|054|52[05]|530|857|860|87[02]|880|89[024])\"\n\n[[9]]\n[1] \"6(30[34]|100|125|44[289]|463)\"\n\n[[10]]\n[1] \"9(587|20[28]|21[34]|22[02-4])\"\n\n[[11]]\n[1] \"C(750|977)\"\n\n[[12]]\n[1] \"G(027|041)\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(50) |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |> \n  recombine4()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"1104\"\n\n[[2]]\n[1] \"3552\"\n\n[[3]]\n[1] \"4557\"\n\n[[4]]\n[1] \"7881\"\n\n[[5]]\n[1] \"G930\"\n\n[[6]]\n[1] \"K007\"\n\n[[7]]\n[1] \"Q429\"\n\n[[8]]\n[1] \"0(231|323)\"\n\n[[9]]\n[1] \"8(035|747)\"\n\n[[10]]\n[1] \"9(231|464|940)\"\n\n[[11]]\n[1] \"A(644|950|970)\"\n\n[[12]]\n[1] \"J(130|159|716|721|750)\"\n\n[[13]]\n[1] \"L(194|596)\"\n```\n\n\n:::\n:::\n\n\n\n\n## recombine5\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrecombine5 <- function(x) {\n  \n  x <- getelem(x, \"g5\")\n  \n  if (empty(x)) \n    return(character(0))\n  \n  c(\n    if (empty(x[vlen(x) == 1])) \n      character(0) \n    else \n      sf_convert(str_glue(\"{list_c(x[vlen(x) == 1])}\")),\n    \n    if (empty(x[vlen(x) > 1])) \n      character(0) \n    else \n      map(\n        x[vlen(x) > 1], function(x) {\n          \n          front <- uniq(sf_sub(delist(x), start = 1, stop = 1))\n          back  <- sf_collapse(sf_remove(delist(x), str_glue(\"^[{front}]{{1}}\")), collapse = \"|\")\n          sf_convert(str_glue(\"{front}({back})\"))\n          }\n        )\n    )\n  }\n\nlong_test2[sf_nchar(long_test2) == 5] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  reduce_groups() |> \n  recombine5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"15777\"\n\n[[2]]\n[1] \"76514\"\n\n[[3]]\n[1] \"E0675\"\n\n[[4]]\n[1] \"S2342\"\n\n[[5]]\n[1] \"0(50[67]T|2[1267][[0-9]]T|3[23][09]T|4[24][245]T)\"\n\n[[6]]\n[1] \"2(0939|719[78]|251[0-5]|252[67])\"\n\n[[7]]\n[1] \"3(080[12]|1231|2673|471[3-7]|5572|6221|4812|4820|483[34])\"\n\n[[8]]\n[1] \"5(0300|0540|5300|8575|860[05]|880[05]|4420|4430|5200|5250|8700|8720|8900|892[05]|894[03])\"\n\n[[9]]\n[1] \"6(100[01]|1253|463[46]|3035|304[3-8]|4421|448[04]|449[1245])\"\n\n[[10]]\n[1] \"9(5870|2025|208[1-3]|213[2-4]|2145|220[12]|222[7-9]|2235|224[02])\"\n\n[[11]]\n[1] \"C(750[1245]|9771)\"\n\n[[12]]\n[1] \"G(0279|041[2-5])\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(50) |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |> \n  recombine5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"1490F\"\n\n[[2]]\n[1] \"3288F\"\n\n[[3]]\n[1] \"32553\"\n\n[[4]]\n[1] \"82487\"\n\n[[5]]\n[1] \"A7034\"\n\n[[6]]\n[1] \"C8902\"\n\n[[7]]\n[1] \"E1594\"\n\n[[8]]\n[1] \"G4006\"\n\n[[9]]\n[1] \"L0640\"\n\n[[10]]\n[1] \"1(2004|5777)\"\n\n[[11]]\n[1] \"2(2110|3101|6117)\"\n\n[[12]]\n[1] \"4(0702|3201)\"\n\n[[13]]\n[1] \"6(1796|2365|9222)\"\n\n[[14]]\n[1] \"7(5746|8271)\"\n\n[[15]]\n[1] \"J(0692|0892|7699|9098)\"\n```\n\n\n:::\n:::\n\n\n\n\n## recombine_groups\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrecombine_groups <- \\(x) {\n  \n  list(\n    v1 = x$g1,\n    v2 = recombine2(x),\n    v3 = recombine3(x),\n    v4 = recombine4(x),\n    v5 = recombine5(x)\n  )\n}\n\nlong_test2 |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  reduce_groups() |> \n  recombine_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$v1\n^[CEGS0-35-79][A-Z0-9]{4}\n\n$v2\ncharacter(0)\n\n$v3\ncharacter(0)\n\n$v4\ncharacter(0)\n\n$v5\ncharacter(0)\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(50) |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |>\n  recombine_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$v1\n^BCRT1[A-Z0-9]{4}\n\n$v2\n^(0[134]|2[78]|3[13]|4[036]|6[34]|78|8[1-36]|9[2468]|A[45]|E[02]|G[089]|H0|J[79]|L[16]|M1|Q4|V5)[A-Z0-9]{3}$\n\n$v3\n$v3[[1]]\n[1] \"H20\"\n\n$v3[[2]]\n[1] \"J08\"\n\n$v3[[3]]\n[1] \"L39\"\n\n$v3[[4]]\n0(08|64)\n\n$v3[[5]]\n2(12|22|51)\n\n$v3[[6]]\n4(11|4[13])\n\n$v3[[7]]\n5(71|85)\n\n$v3[[8]]\n6(17|57)\n\n$v3[[9]]\n7(0[35]|58|65)\n\n$v3[[10]]\n9(37|59|9[25])\n\n$v3[[11]]\nG(21|40)\n\n$v3[[12]]\nS(03|40)\n\n\n$v4\n$v4[[1]]\n[1] \"0023\"\n\n$v4[[2]]\n[1] \"3265\"\n\n$v4[[3]]\n[1] \"5250\"\n\n$v4[[4]]\n[1] \"9397\"\n\n$v4[[5]]\n[1] \"A623\"\n\n$v4[[6]]\n[1] \"D017\"\n\n$v4[[7]]\n[1] \"E125\"\n\n$v4[[8]]\n[1] \"J159\"\n\n$v4[[9]]\n[1] \"2(11[24]|133|192)\"\n\n$v4[[10]]\n[1] \"4(960|990)\"\n\n$v4[[11]]\n[1] \"6(164|225|966|980)\"\n\n$v4[[12]]\n[1] \"7(596|741)\"\n\n$v4[[13]]\n[1] \"8(035|554|710)\"\n\n$v4[[14]]\n[1] \"L(226|302)\"\n\n$v4[[15]]\n[1] \"S(100|499)\"\n\n\n$v5\n$v5[[1]]\n[1] \"0[57][24][59]T\"\n\n$v5[[2]]\n[1] \"35122\"\n\n$v5[[3]]\n[1] \"69440\"\n\n$v5[[4]]\n[1] \"75561\"\n\n$v5[[5]]\n[1] \"89398\"\n\n$v5[[6]]\n[1] \"D5936\"\n\n$v5[[7]]\n[1] \"G1027\"\n\n$v5[[8]]\n[1] \"L3610\"\n\n$v5[[9]]\n[1] \"Q0509\"\n\n$v5[[10]]\n[1] \"2(4346|5490|6676)\"\n\n$v5[[11]]\n[1] \"5(0380|0551)\"\n\n$v5[[12]]\n[1] \"9(0750|3248|3998)\"\n\n$v5[[13]]\n[1] \"J(0173|0775|1320|1814|2182)\"\n\n$v5[[14]]\n[1] \"S(0040|9366)\"\n```\n\n\n:::\n:::\n\n\n\n\n\n::: \n\n\n\n\n\n{{< pagebreak >}}\n\n\n\n\n\n\n# Collapse Regex\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nvec_to_regex <- vrg <- \\(x, n) {\n  \n  if (empty(x)) \n    return(character(0))\n  \n  post <- iif_else(sf_detect(x, \"^\\\\[?[A-Z]\\\\-?\"), \"[0-9]\", \"[A-Z0-9]\")\n  \n  x <- fcase(\n    n == 0, glue::glue(\"^{x}$\"),                \n    n == 1, glue::glue(\"^{x}{post}$\"),\n    n == 2, glue::glue(\"^{x}{post}{{2}}$\"),\n    n == 3, glue::glue(\"^{x}{post}{{3}}$\")\n    )\n    \n  glue::glue_collapse(x)\n}\n\ncollapse_regex <- \\(x) {\n  \n  list(\n    g1 = red1(x),\n    g2 = map_chr(x$g2, red2) |> map_chr(vrg, n = 3) |> glue::as_glue(),\n    g3 = map_chr(x$g3, red3) |> map_chr(vrg, n = 2) |> glue::as_glue(),\n    g4 = map_chr(x$g4, red4) |> map_chr(vrg, n = 1) |> glue::as_glue(),\n    g5 = map_chr(x$g5, red5) |> map_chr(vrg, n = 0) |> glue::as_glue()\n  )\n}\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n{{< pagebreak >}}\n\n\n\n\n\n\n# S7 Class\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhcpcs <- new_class(\n  name = \"hcpcs\",\n  properties = list(\n    input = class_vector,\n    split_length     = new_property(class = class_list, getter = \\(self) split_lengths(self@input)),\n    remove_redundant = new_property(class = class_list, getter = \\(self) remove_redundant(self@split_length)),\n    split_first      = new_property(class = class_list, getter = \\(self) split_first(self@remove_redundant)),\n    process_groups   = new_property(class = class_list, getter = \\(self) process_groups(self@split_first)),\n    reduce_groups    = new_property(class = class_list, getter = \\(self) reduce_groups(self@process_groups)),\n    recombine_groups = new_property(class = class_list, getter = \\(self) recombine_groups(self@reduce_groups))\n    )\n  )\n\nx <- hcpcs(input = random_hcpcs(50))\n\nx\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<hcpcs>\n @ input           : chr [1:205] \"9\" \"K\" \"A\" \"G\" \"E\" \"43\" \"08\" \"62\" \"A4\" \"93\" \"58\" \"M1\" ...\n @ split_length    :List of 5\n .. $ x1: chr [1:5] \"9\" \"A\" \"E\" \"G\" ...\n .. $ x2: chr [1:42] \"02\" \"04\" \"08\" \"11\" ...\n .. $ x3: chr [1:47] \"009\" \"013\" \"044\" \"063\" ...\n .. $ x4: chr [1:50] \"0144\" \"0148\" \"0345\" \"0403\" ...\n .. $ x5: chr [1:50] \"0062U\" \"0676T\" \"0704T\" \"1111F\" ...\n @ remove_redundant:List of 5\n .. $ x1: chr [1:5] \"9\" \"A\" \"E\" \"G\" ...\n .. $ x2: chr [1:33] \"02\" \"04\" \"08\" \"11\" ...\n .. $ x3: chr [1:26] \"009\" \"013\" \"063\" \"079\" ...\n .. $ x4: chr [1:30] \"0144\" \"0148\" \"0345\" \"0527\" ...\n .. $ x5: chr [1:27] \"0062U\" \"0676T\" \"0704T\" \"15792\" ...\n @ split_first     :List of 5\n .. $ x1:List of 1\n ..  ..$ : chr [1:5] \"9\" \"A\" \"E\" \"G\" ...\n .. $ x2:List of 16\n ..  ..$ : chr [1:3] \"02\" \"04\" \"08\"\n ..  ..$ : chr \"11\"\n ..  ..$ : chr [1:3] \"21\" \"22\" \"27\"\n ..  ..$ : chr [1:4] \"33\" \"34\" \"35\" \"36\"\n ..  ..$ : chr \"43\"\n ..  ..$ : chr [1:3] \"52\" \"53\" \"58\"\n ..  ..$ : chr [1:3] \"61\" \"62\" \"69\"\n ..  ..$ : chr [1:3] \"82\" \"86\" \"88\"\n ..  ..$ : chr \"B9\"\n ..  ..$ : chr \"C9\"\n ..  ..$ : chr \"D5\"\n ..  ..$ : chr [1:4] \"J1\" \"J7\" \"J8\" \"J9\"\n ..  ..$ : chr \"L5\"\n ..  ..$ : chr \"M1\"\n ..  ..$ : chr [1:2] \"S0\" \"S9\"\n ..  ..$ : chr \"V5\"\n .. $ x3:List of 11\n ..  ..$ : chr [1:4] \"009\" \"013\" \"063\" \"079\"\n ..  ..$ : chr [1:2] \"101\" \"192\"\n ..  ..$ : chr [1:2] \"254\" \"262\"\n ..  ..$ : chr \"325\"\n ..  ..$ : chr \"421\"\n ..  ..$ : chr [1:2] \"555\" \"574\"\n ..  ..$ : chr \"687\"\n ..  ..$ : chr \"772\"\n ..  ..$ : chr [1:6] \"834\" \"853\" \"854\" \"875\" ...\n ..  ..$ : chr \"C13\"\n ..  ..$ : chr [1:5] \"L20\" \"L28\" \"L32\" \"L34\" ...\n .. $ x4:List of 14\n ..  ..$ : chr [1:5] \"0144\" \"0148\" \"0345\" \"0527\" ...\n ..  ..$ : chr [1:3] \"2341\" \"2465\" \"2512\"\n ..  ..$ : chr \"3232\"\n ..  ..$ : chr [1:2] \"4180\" \"4952\"\n ..  ..$ : chr [1:3] \"5106\" \"5401\" \"5961\"\n ..  ..$ : chr [1:2] \"6791\" \"6851\"\n ..  ..$ : chr [1:3] \"7698\" \"7705\" \"7752\"\n ..  ..$ : chr [1:3] \"8035\" \"8423\" \"8442\"\n ..  ..$ : chr \"C756\"\n ..  ..$ : chr [1:2] \"J046\" \"J276\"\n ..  ..$ : chr \"L197\"\n ..  ..$ : chr [1:2] \"Q432\" \"Q510\"\n ..  ..$ : chr \"S401\"\n ..  ..$ : chr \"V211\"\n .. $ x5:List of 16\n ..  ..$ : chr \"15792\"\n ..  ..$ : chr [1:2] \"29823\" \"29895\"\n ..  ..$ : chr [1:3] \"37215\" \"37217\" \"39503\"\n ..  ..$ : chr \"44187\"\n ..  ..$ : chr [1:4] \"51040\" \"54057\" \"54411\" \"59136\"\n ..  ..$ : chr \"67906\"\n ..  ..$ : chr \"70336\"\n ..  ..$ : chr [1:2] \"81317\" \"87487\"\n ..  ..$ : chr \"C1772\"\n ..  ..$ : chr \"H0014\"\n ..  ..$ : chr [1:4] \"L0462\" \"L0651\" \"L3031\" \"L6955\"\n ..  ..$ : chr \"Q4153\"\n ..  ..$ : chr \"S2208\"\n ..  ..$ : chr \"4250F\"\n ..  ..$ : chr [1:2] \"0676T\" \"0704T\"\n ..  ..$ : chr \"0062U\"\n @ process_groups  :List of 5\n .. $ g1:List of 1\n ..  ..$ : chr [1:5] \"9\" \"A\" \"E\" \"G\" ...\n .. $ g2:List of 16\n ..  ..$ : chr [1:3] \"02\" \"04\" \"08\"\n ..  ..$ : chr \"11\"\n ..  ..$ : chr [1:3] \"21\" \"22\" \"27\"\n ..  ..$ : chr [1:4] \"33\" \"34\" \"35\" \"36\"\n ..  ..$ : chr \"43\"\n ..  ..$ : chr [1:3] \"52\" \"53\" \"58\"\n ..  ..$ : chr [1:3] \"61\" \"62\" \"69\"\n ..  ..$ : chr [1:3] \"82\" \"86\" \"88\"\n ..  ..$ : chr \"B9\"\n ..  ..$ : chr \"C9\"\n ..  ..$ : chr \"D5\"\n ..  ..$ : chr [1:4] \"J1\" \"J7\" \"J8\" \"J9\"\n ..  ..$ : chr \"L5\"\n ..  ..$ : chr \"M1\"\n ..  ..$ : chr [1:2] \"S0\" \"S9\"\n ..  ..$ : chr \"V5\"\n .. $ g3:List of 11\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"009\"\n ..  .. ..$ : chr \"013\"\n ..  .. ..$ : chr \"063\"\n ..  .. ..$ : chr \"079\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"101\"\n ..  .. ..$ : chr \"192\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"254\"\n ..  .. ..$ : chr \"262\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"325\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"421\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"555\"\n ..  .. ..$ : chr \"574\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"687\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"772\"\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"834\"\n ..  .. ..$ : chr [1:2] \"853\" \"854\"\n ..  .. ..$ : chr \"875\"\n ..  .. ..$ : chr [1:2] \"890\" \"893\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"C13\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr [1:2] \"L20\" \"L28\"\n ..  .. ..$ : chr [1:2] \"L32\" \"L34\"\n ..  .. ..$ : chr \"L86\"\n .. $ g4:List of 14\n ..  ..$ :List of 4\n ..  .. ..$ : chr [1:2] \"0144\" \"0148\"\n ..  .. ..$ : chr \"0345\"\n ..  .. ..$ : chr \"0527\"\n ..  .. ..$ : chr \"0647\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"2341\"\n ..  .. ..$ : chr \"2465\"\n ..  .. ..$ : chr \"2512\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"3232\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"4180\"\n ..  .. ..$ : chr \"4952\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"5106\"\n ..  .. ..$ : chr \"5401\"\n ..  .. ..$ : chr \"5961\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"6791\"\n ..  .. ..$ : chr \"6851\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"7698\"\n ..  .. ..$ : chr \"7705\"\n ..  .. ..$ : chr \"7752\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"8035\"\n ..  .. ..$ : chr \"8423\"\n ..  .. ..$ : chr \"8442\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"C756\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"J046\"\n ..  .. ..$ : chr \"J276\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"L197\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"Q432\"\n ..  .. ..$ : chr \"Q510\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"S401\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"V211\"\n .. $ g5:List of 16\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"4250F\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr [1:2] \"0676T\" \"0704T\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"0062U\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"15792\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"29823\"\n ..  .. ..$ : chr \"29895\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr [1:2] \"37215\" \"37217\"\n ..  .. ..$ : chr \"39503\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"44187\"\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"51040\"\n ..  .. ..$ : chr \"54057\"\n ..  .. ..$ : chr \"54411\"\n ..  .. ..$ : chr \"59136\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"67906\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"70336\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"81317\"\n ..  .. ..$ : chr \"87487\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"C1772\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"H0014\"\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"L0462\"\n ..  .. ..$ : chr \"L0651\"\n ..  .. ..$ : chr \"L3031\"\n ..  .. ..$ : chr \"L6955\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"Q4153\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"S2208\"\n @ reduce_groups   :List of 5\n .. $ g1: 'glue' chr \"^AEGK9[A-Z0-9]{4}\"\n .. $ g2:List of 16\n ..  ..$ : chr \"0[248]\"\n ..  ..$ : chr \"11\"\n ..  ..$ : chr \"2[127]\"\n ..  ..$ : chr \"3[3-6]\"\n ..  ..$ : chr \"43\"\n ..  ..$ : chr \"5[238]\"\n ..  ..$ : chr \"6[129]\"\n ..  ..$ : chr \"8[268]\"\n ..  ..$ : chr \"B9\"\n ..  ..$ : chr \"C9\"\n ..  ..$ : chr \"D5\"\n ..  ..$ : chr \"J[17-9]\"\n ..  ..$ : chr \"L5\"\n ..  ..$ : chr \"M1\"\n ..  ..$ : chr \"S[09]\"\n ..  ..$ : chr \"V5\"\n .. $ g3:List of 11\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"009\"\n ..  .. ..$ : chr \"013\"\n ..  .. ..$ : chr \"063\"\n ..  .. ..$ : chr \"079\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"101\"\n ..  .. ..$ : chr \"192\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"254\"\n ..  .. ..$ : chr \"262\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"325\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"421\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"555\"\n ..  .. ..$ : chr \"574\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"687\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"772\"\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"834\"\n ..  .. ..$ : chr \"85[34]\"\n ..  .. ..$ : chr \"875\"\n ..  .. ..$ : chr \"89[03]\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"C13\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"L2[08]\"\n ..  .. ..$ : chr \"L3[24]\"\n ..  .. ..$ : chr \"L86\"\n .. $ g4:List of 14\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"014[48]\"\n ..  .. ..$ : chr \"0345\"\n ..  .. ..$ : chr \"0527\"\n ..  .. ..$ : chr \"0647\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"2341\"\n ..  .. ..$ : chr \"2465\"\n ..  .. ..$ : chr \"2512\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"3232\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"4180\"\n ..  .. ..$ : chr \"4952\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"5106\"\n ..  .. ..$ : chr \"5401\"\n ..  .. ..$ : chr \"5961\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"6791\"\n ..  .. ..$ : chr \"6851\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"7698\"\n ..  .. ..$ : chr \"7705\"\n ..  .. ..$ : chr \"7752\"\n ..  ..$ :List of 3\n ..  .. ..$ : chr \"8035\"\n ..  .. ..$ : chr \"8423\"\n ..  .. ..$ : chr \"8442\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"C756\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"J046\"\n ..  .. ..$ : chr \"J276\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"L197\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"Q432\"\n ..  .. ..$ : chr \"Q510\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"S401\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"V211\"\n .. $ g5:List of 16\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"4250F\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"0[67][07][46]T\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"0062U\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"15792\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"29823\"\n ..  .. ..$ : chr \"29895\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"3721[57]\"\n ..  .. ..$ : chr \"39503\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"44187\"\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"51040\"\n ..  .. ..$ : chr \"54057\"\n ..  .. ..$ : chr \"54411\"\n ..  .. ..$ : chr \"59136\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"67906\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"70336\"\n ..  ..$ :List of 2\n ..  .. ..$ : chr \"81317\"\n ..  .. ..$ : chr \"87487\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"C1772\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"H0014\"\n ..  ..$ :List of 4\n ..  .. ..$ : chr \"L0462\"\n ..  .. ..$ : chr \"L0651\"\n ..  .. ..$ : chr \"L3031\"\n ..  .. ..$ : chr \"L6955\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"Q4153\"\n ..  ..$ :List of 1\n ..  .. ..$ : chr \"S2208\"\n @ recombine_groups:List of 5\n .. $ v1: 'glue' chr \"^AEGK9[A-Z0-9]{4}\"\n .. $ v2: 'glue' chr \"^(0[248]|11|2[127]|3[3-6]|43|5[238]|6[129]|8[268]|B9|C9|D5|J[17-9]|L5|M1|S[09]|V5)[A-Z0-9]{3}$\"\n .. $ v3:List of 11\n ..  ..$ : chr \"325\"\n ..  ..$ : chr \"421\"\n ..  ..$ : chr \"687\"\n ..  ..$ : chr \"772\"\n ..  ..$ : chr \"C13\"\n ..  ..$ : 'glue' chr \"0(09|13|63|79)\"\n ..  ..$ : 'glue' chr \"1(01|92)\"\n ..  ..$ : 'glue' chr \"2(54|62)\"\n ..  ..$ : 'glue' chr \"5(55|74)\"\n ..  ..$ : 'glue' chr \"8(34|5[34]|75|9[03])\"\n ..  ..$ : 'glue' chr \"L(2[08]|3[24]|86)\"\n .. $ v4:List of 14\n ..  ..$ : chr \"3232\"\n ..  ..$ : chr \"C756\"\n ..  ..$ : chr \"L197\"\n ..  ..$ : chr \"S401\"\n ..  ..$ : chr \"V211\"\n ..  ..$ : chr \"0(14[48]|345|527|647)\"\n ..  ..$ : chr \"2(341|465|512)\"\n ..  ..$ : chr \"4(180|952)\"\n ..  ..$ : chr \"5(106|401|961)\"\n ..  ..$ : chr \"6(791|851)\"\n ..  ..$ : chr \"7(698|705|752)\"\n ..  ..$ : chr \"8(035|423|442)\"\n ..  ..$ : chr \"J(046|276)\"\n ..  ..$ : chr \"Q(432|510)\"\n .. $ v5:List of 16\n ..  ..$ : chr \"4250F\"\n ..  ..$ : chr \"0[67][07][46]T\"\n ..  ..$ : chr \"0062U\"\n ..  ..$ : chr \"15792\"\n ..  ..$ : chr \"44187\"\n ..  ..$ : chr \"67906\"\n ..  ..$ : chr \"70336\"\n ..  ..$ : chr \"C1772\"\n ..  ..$ : chr \"H0014\"\n ..  ..$ : chr \"Q4153\"\n ..  ..$ : chr \"S2208\"\n ..  ..$ : chr \"2(9823|9895)\"\n ..  ..$ : chr \"3(721[57]|9503)\"\n ..  ..$ : chr \"5(1040|4057|4411|9136)\"\n ..  ..$ : chr \"8(1317|7487)\"\n ..  ..$ : chr \"L(0462|0651|3031|6955)\"\n```\n\n\n:::\n:::\n\n{{< pagebreak >}}\n\n\n\n\n\n\n::: {#nte-references .callout-tip collapse=\"true\"}\n\n## Links\n### Reference\n\n   - [Regex Cheatsheet](https://github.com/raredd/regex)\n   - [Learn Regex](https://github.com/ziishaned/learn-regex)\n   - [Evaluating strings as code](https://josiahparry.com/posts/2024-06-13-eval-strings)\n   - [Building rules from code operands](https://github.com/Permian-Global-Research/rsi)\n   - [Filter logic](https://github.com/atorus-research/ardis/blob/main/R/denom.R)\n   - [Regular-Expression.info](https://www.regular-expressions.info/tutorial.html)\n   - [RexEgg](https://www.rexegg.com/)\n   - [Regular Expressions as used in R](https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html)\n   - [Debuggex](https://www.debuggex.com/)\n\n### Packages\n\n   - [**textshape**](https://github.com/trinker/textshape)\n   - [**stringr.plus**](https://github.com/johncassil/stringr.plus)\n   - [**regexmagic**](https://github.com/jonocarroll/regexmagic)\n   - [**makeunique**](https://github.com/selkamand/makeunique)\n   - [**similiars**](https://github.com/davidsjoberg/similiars)\n   - [**strex**](https://github.com/rorynolan/strex/)\n   - [**stringfish**](https://github.com/traversc/stringfish)\n   - [**collapse**](https://sebkrantz.github.io/collapse/)\n   - [**kit**](https://github.com/2005m/kit)\n   - [**cheapr**](https://github.com/NicChr/cheapr)\n   - [**fastplyr**](https://github.com/NicChr/fastplyr)\n   - [**stringi**](https://stringi.gagolewski.com/)\n   - [**qdapRegex**](https://github.com/trinker/qdapRegex)\n   - [**charcuterie**](https://github.com/jonocarroll/charcuterie)\n\n### Functions\n\n   - [mark::globbing](https://github.com/jmbarbone/mark/blob/main/R/glob.R)\n   - [RUtil::make_unique_comb](https://github.com/raivokolde/RUtil/blob/master/Source/R/make_unique_comb.r)\n   - [mirmisc::longest_common_substring](https://github.com/mirvie/mirmisc/blob/main/R/utils.R)\n   - [hutils::longest prefix/suffix](https://github.com/HughParsonage/hutils/blob/master/R/longest_affix.R)\n   - [tidyext::combn_2_col](https://github.com/m-clark/tidyext/blob/master/R/combn_2_col.R)\n\n::: \n\n\n## Session Information \n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n**R version 4.4.2 (2024-10-31 ucrt)**\n\n**Platform:** x86_64-w64-mingw32/x64 \n\n**locale:**\n_LC_COLLATE=English_United States.utf8_, _LC_CTYPE=English_United States.utf8_, _LC_MONETARY=English_United States.utf8_, _LC_NUMERIC=C_ and _LC_TIME=English_United States.utf8_\n\n**attached base packages:** \n_compiler_, _stats_, _graphics_, _grDevices_, _utils_, _datasets_, _methods_ and _base_\n\n**other attached packages:** \n_codex(v.0.0.0.9000)_, _kit(v.0.0.19)_, _collapse(v.2.0.17)_, _data.table(v.1.16.99)_, _stringfish(v.0.16.0)_, _S7(v.0.2.0)_, _vctrs(v.0.6.5)_, _cli(v.3.6.3)_, _rlang(v.1.1.4)_, _stringr(v.1.5.1)_, _purrr(v.1.0.2)_, _dplyr(v.1.1.4)_ and _fuimus(v.0.0.2)_\n\n**loaded via a namespace (and not attached):** \n_rappdirs(v.0.3.3)_, _utf8(v.1.2.4)_, _generics(v.0.1.3)_, _stringi(v.1.8.4)_, _digest(v.0.6.37)_, _magrittr(v.2.0.3)_, _evaluate(v.1.0.1)_, _fastmap(v.1.2.0)_, _rprojroot(v.2.0.4)_, _jsonlite(v.1.8.9)_, _pins(v.1.4.0)_, _bench(v.1.1.3)_, _pander(v.0.6.5)_, _fansi(v.1.0.6)_, _northstar(v.0.0.7)_, _textshaping(v.0.4.0)_, _RApiSerialize(v.0.1.4)_, _crayon(v.1.5.3)_, _withr(v.3.0.2)_, _yaml(v.2.3.10)_, _tools(v.4.4.2)_, _qs(v.0.27.2)_, _parallel(v.4.4.2)_, _profmem(v.0.6.0)_, _here(v.1.0.1)_, _R6(v.2.5.1)_, _lifecycle(v.1.0.4)_, _cheapr(v.0.9.91)_, _fs(v.1.6.5)_, _htmlwidgets(v.1.6.4)_, _ragg(v.1.3.3)_, _pkgconfig(v.2.0.3)_, _RcppParallel(v.5.1.9)_, _pillar(v.1.9.0)_, _glue(v.1.8.0)_, _Rcpp(v.1.0.13-1)_, _systemfonts(v.1.1.0)_, _xfun(v.0.49)_, _tibble(v.3.2.1)_, _tidyselect(v.1.2.1)_, _rstudioapi(v.0.17.1)_, _knitr(v.1.49)_, _htmltools(v.0.5.8.1)_ and _rmarkdown(v.2.29)_\n:::\n:::\n",
    "supporting": [
      "regex_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}