{
  "hash": "f62bb4435a744d25304d68de696fb2d1",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Learning to Love Regexes By Learning Them\"\nsubtitle: \"I Promised Myself I Wouldn't Do This Again\"\ndescription: \"Building a regex generator for self-contained, well-defined string detection problems is a very effective way to learn regular expressions.\"\nformat:\n  html:\n    reference-location: margin\n    other-links:\n      - text: Regex Cheatsheet\n        icon: bookmark-plus\n        href: https://github.com/raredd/regex\n      - text: RexEgg\n        icon: bookmark-plus\n        href: https://www.rexegg.com/\n      - text: Regex in R\n        icon: bookmark-plus\n        href: https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n# HCPCS Overview\n\n\n\n\n::: {.cell layout-align=\"center\"}\n`````{=html}\n<pre style=''>\n<span style='text-decoration:underline;'>                 Count                                 Regex</span><br/>All             <span style='color:#ffffff;'><span style='background-color:#000000;'> 18903</span></span><span><span> ^[A-CEGHJ-MP-V0-9][0-9]{3}[AFMTU0-9]$</span></span><br/>-Level I        <span style='color:#ffffff;'><span style='background-color:#333333;'> 10985</span></span><span><span>                  ^[0-9]{4}[AFMTU0-9]$</span></span><br/>--Category I    <span style='color:#ffffff;'><span style='background-color:#7f7f7f;'>  9990</span></span><span><span>                    ^[0-9]{4}[AMU0-9]$</span></span><br/>--Category II   <span style='color:#000000;'><span style='background-color:#cccccc;'>   565</span></span><span><span>                           ^[0-9]{4}F$</span></span><br/>--Category III  <span style='color:#000000;'><span style='background-color:#e5e5e5;'>   430</span></span><span><span>                           ^[0-9]{4}T$</span></span><br/>-Level II       <span style='color:#ffffff;'><span style='background-color:#333333;'>  7918</span></span><span><span>              ^[A-CEGHJ-MP-V][0-9]{4}$</span></span><br/>\n</pre>\n`````\n:::\n\n\n\n\n### Letters\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stderr}\n\n```\nHCPCS Ending with Letter:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nA : 33\nF : 565\nM : 13\nT : 430\nU : 337\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nTotal: 1378\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nHCPCS Beginning with Letter:\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nA : 793\nB : 51\nC : 548\nE : 639\nG : 1939\nH : 89\nJ : 1068\nK : 175\nL : 913\nM : 360\nP : 57\nQ : 462\nR : 3\nS : 500\nT : 113\nU : 5\nV : 203\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nTotal:7918\n```\n\n\n:::\n:::\n\n\n\n\n# TODO\n\n   * If a **wildcard** begins with a **letter**, the *postfix* should be `[0-9]{n}`.\n   * In `remove_redundant()`, try pmap for `rr()` step.\n\n\n## Checklist\n\n-   [X] `split_lengths()`\n-   [X] `remove_redundant()`\n-   [X] `split_first()`\n-   [ ] `process_groups()`\n   - `group_3()`\n   - `group_4()`\n   - `group_5()`\n-   [ ] `reduce_groups()`\n   - `reduce_runs()`\n   - `vec_to_regex()`\n   - `red1()`\n   - `red2()`\n   - `red3()`\n\n# Preprocessing\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nx <- random_hcpcs()\n\n# x |> split_lengths()\n# \n# x |>\n#   split_lengths() |>\n#   remove_redundant()\n# \n# x |>\n#   split_lengths() |>\n#   remove_redundant() |>\n#   split_first()\n\nx |> \n  split_lengths() |>\n  remove_redundant() |>\n  split_first()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$x1\n$x1[[1]]\n[1] \"U\"\n\n\n$x2\n$x2[[1]]\n[1] \"05\"\n\n$x2[[2]]\n[1] \"33\"\n\n$x2[[3]]\n[1] \"88\"\n\n$x2[[4]]\n[1] \"94\" \"96\"\n\n$x2[[5]]\n[1] \"J2\"\n\n$x2[[6]]\n[1] \"K0\"\n\n$x2[[7]]\n[1] \"L3\"\n\n\n$x3\n$x3[[1]]\n[1] \"003\"\n\n$x3[[2]]\n[1] \"613\"\n\n$x3[[3]]\n[1] \"G90\" \"G96\"\n\n$x3[[4]]\n[1] \"J76\"\n\n$x3[[5]]\n[1] \"L86\"\n\n$x3[[6]]\n[1] \"V52\"\n\n\n$x4\n$x4[[1]]\n[1] \"1511\"\n\n$x4[[2]]\n[1] \"2335\"\n\n$x4[[3]]\n[1] \"6328\"\n\n$x4[[4]]\n[1] \"8130\" \"8274\"\n\n$x4[[5]]\n[1] \"9226\"\n\n$x4[[6]]\n[1] \"A621\"\n\n$x4[[7]]\n[1] \"G400\" \"G892\"\n\n$x4[[8]]\n[1] \"S240\"\n\n\n$x5\n$x5[[1]]\n[1] \"12011\" \"13160\"\n\n$x5[[2]]\n[1] \"29866\"\n\n$x5[[3]]\n[1] \"86580\"\n\n$x5[[4]]\n[1] \"A4287\"\n\n$x5[[5]]\n[1] \"G9895\"\n\n$x5[[6]]\n[1] \"M1041\" \"M1334\"\n\n$x5[[7]]\n[1] \"Q0164\"\n```\n\n\n:::\n:::\n\n\n\n\n# Grouping\n\nGroup each set of vectors into regex patterns. Deal with groups containing letters separately.\n\n::: {.panel-tabset}\n\n## Group 3\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nc(\"C75\", \"C97\", \"G02\", \"G04\") |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"C75\"\n\n[[1]][[2]]\n[1] \"C97\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"G02\" \"G04\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlong_test2[nchar(long_test2) == 3] |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"021\" \"022\" \"026\" \"027\"\n\n[[1]][[2]]\n[1] \"032\" \"033\"\n\n[[1]][[3]]\n[1] \"042\" \"044\"\n\n[[1]][[4]]\n[1] \"050\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"157\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"209\"\n\n[[3]][[2]]\n[1] \"225\"\n\n[[3]][[3]]\n[1] \"271\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"308\"\n\n[[4]][[2]]\n[1] \"312\"\n\n[[4]][[3]]\n[1] \"326\"\n\n[[4]][[4]]\n[1] \"347\" \"348\"\n\n[[4]][[5]]\n[1] \"355\"\n\n[[4]][[6]]\n[1] \"362\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"503\" \"505\"\n\n[[5]][[2]]\n[1] \"544\"\n\n[[5]][[3]]\n[1] \"552\" \"553\"\n\n[[5]][[4]]\n[1] \"585\" \"586\" \"587\" \"588\" \"589\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"610\" \"612\"\n\n[[6]][[2]]\n[1] \"630\"\n\n[[6]][[3]]\n[1] \"644\" \"646\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"765\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"920\" \"921\" \"922\"\n\n[[8]][[2]]\n[1] \"958\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C75\"\n\n[[9]][[2]]\n[1] \"C97\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E06\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G02\" \"G04\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S23\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(50) |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"007\"\n\n[[1]][[2]]\n[1] \"032\" \"036\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"221\" \"228\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"371\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"407\"\n\n[[4]][[2]]\n[1] \"413\"\n\n[[4]][[3]]\n[1] \"455\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"611\"\n\n[[5]][[2]]\n[1] \"623\"\n\n[[5]][[3]]\n[1] \"661\"\n\n[[5]][[4]]\n[1] \"699\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"909\"\n\n[[6]][[2]]\n[1] \"913\"\n\n[[6]][[3]]\n[1] \"957\" \"958\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"E09\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"G10\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"J29\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"L37\"\n\n[[10]][[2]]\n[1] \"L56\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"S51\"\n\n[[11]][[2]]\n[1] \"S91\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"T10\"\n```\n\n\n:::\n:::\n\n\n\n\n## Group 4\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngroup_4 <- function(x) {\n\n  x <- getelem(x, \"x4\")\n  \n  if (empty(x)) return(x)\n  \n  map(x, function(x) {\n    \n    idx <- data.table(\n      code = x,\n      grp1 = sf_sub(x, 1, 2),\n      grp2 = sf_sub(x, 1, 3),\n      a1 = take_at(x),\n      a2 = take_at(x, 2),\n      a3 = take_at(x, 3),\n      a4 = take_at(x, 4),\n      i1 = groupid(take_at(x))) |>\n      fgroup_by(a1) |>\n      fmutate(i2 = groupid(a2)) |>\n      fgroup_by(a1, a2) |>\n      fmutate(i3 = groupid(a3)) |> \n      fgroup_by(a1, a2, a3) |>\n      fmutate(i4 = groupid(a4)) |> \n      fungroup()\n    \n    lone <- fcount(idx, i1, add = TRUE) |>\n        fsubset((i2 + i3 + i4 + N) == 4)\n    \n    last <- fsubset(idx, code %!in% lone[[\"code\"]])\n    \n    last <- join(\n        fcount(last, grp1, a3),\n        fcount(last, grp1, name = \"G\"), on = \"grp1\", verbose = 0) |>\n        fsubset(N == G) |>\n        join(last, on = c(\"grp1\", \"a3\"), how = \"right\", verbose = 0) |>\n        fsubset(not_na(N))\n    \n      rest <- fsubset(idx, code %!in% c(lone[[\"code\"]], last[[\"code\"]]))\n      \n      c(if (empty(lone)) NULL else list(lone[[\"code\"]]),\n        if (empty(last)) NULL else gchop(last[[\"code\"]], last[[\"grp1\"]]),\n        if (empty(rest)) NULL else gchop(rest[[\"code\"]], rest[[\"grp2\"]]))\n    })\n}\n\nc(\"C751\", \"C970\", \"G020\", \"G040\") |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_4()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"C751\"\n\n[[1]][[2]]\n[1] \"C970\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"G020\"\n\n[[2]][[2]]\n[1] \"G040\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlong_test2[nchar(long_test2) == 4] |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_4()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"0506\" \"0507\"\n\n[[1]][[2]]\n[1] \"0214\" \"0215\" \"0217\" \"0218\" \"0219\"\n\n[[1]][[3]]\n[1] \"0220\" \"0221\" \"0222\"\n\n[[1]][[4]]\n[1] \"0263\" \"0265\" \"0266\" \"0269\"\n\n[[1]][[5]]\n[1] \"0274\" \"0275\"\n\n[[1]][[6]]\n[1] \"0329\"\n\n[[1]][[7]]\n[1] \"0330\"\n\n[[1]][[8]]\n[1] \"0422\"\n\n[[1]][[9]]\n[1] \"0444\" \"0445\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"1577\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"2093\"\n\n[[3]][[2]]\n[1] \"2251\" \"2252\"\n\n[[3]][[3]]\n[1] \"2719\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"3080\"\n\n[[4]][[2]]\n[1] \"3123\"\n\n[[4]][[3]]\n[1] \"3267\"\n\n[[4]][[4]]\n[1] \"3557\"\n\n[[4]][[5]]\n[1] \"3622\"\n\n[[4]][[6]]\n[1] \"3471\"\n\n[[4]][[7]]\n[1] \"3481\" \"3482\" \"3483\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"5442\" \"5443\"\n\n[[5]][[2]]\n[1] \"5030\"\n\n[[5]][[3]]\n[1] \"5054\"\n\n[[5]][[4]]\n[1] \"5520\" \"5525\"\n\n[[5]][[5]]\n[1] \"5530\"\n\n[[5]][[6]]\n[1] \"5857\"\n\n[[5]][[7]]\n[1] \"5860\"\n\n[[5]][[8]]\n[1] \"5870\" \"5872\"\n\n[[5]][[9]]\n[1] \"5880\"\n\n[[5]][[10]]\n[1] \"5890\" \"5892\" \"5894\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"6303\" \"6304\"\n\n[[6]][[2]]\n[1] \"6100\"\n\n[[6]][[3]]\n[1] \"6125\"\n\n[[6]][[4]]\n[1] \"6442\" \"6448\" \"6449\"\n\n[[6]][[5]]\n[1] \"6463\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"7651\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"9587\"\n\n[[8]][[2]]\n[1] \"9202\" \"9208\"\n\n[[8]][[3]]\n[1] \"9213\" \"9214\"\n\n[[8]][[4]]\n[1] \"9220\" \"9222\" \"9223\" \"9224\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C750\"\n\n[[9]][[2]]\n[1] \"C977\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E067\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G027\"\n\n[[11]][[2]]\n[1] \"G041\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S234\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(50) |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_4()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"0206\"\n\n[[1]][[2]]\n[1] \"0551\"\n\n[[1]][[3]]\n[1] \"0067\"\n\n[[1]][[4]]\n[1] \"0086\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"1734\"\n\n[[2]][[2]]\n[1] \"1573\"\n\n[[2]][[3]]\n[1] \"1595\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"2066\"\n\n[[3]][[2]]\n[1] \"2251\"\n\n[[3]][[3]]\n[1] \"2733\"\n\n[[3]][[4]]\n[1] \"2742\"\n\n[[3]][[5]]\n[1] \"2789\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"5710\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"6450\"\n\n[[5]][[2]]\n[1] \"6650\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"7013\"\n\n[[6]][[2]]\n[1] \"7355\"\n\n[[6]][[3]]\n[1] \"7471\"\n\n[[6]][[4]]\n[1] \"7846\"\n\n[[6]][[5]]\n[1] \"7859\"\n\n[[6]][[6]]\n[1] \"7864\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"8443\"\n\n[[7]][[2]]\n[1] \"8816\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"A043\"\n\n[[8]][[2]]\n[1] \"A952\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"L213\"\n\n[[9]][[2]]\n[1] \"L596\"\n\n[[9]][[3]]\n[1] \"L869\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"S510\"\n\n[[10]][[2]]\n[1] \"S899\"\n```\n\n\n:::\n:::\n\n\n\n\n## Group 5\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngroup_5 <- function(x) {\n\n  x <- getelem(x, \"x5\")\n  \n  if (empty(x)) return(x)\n  \n  # x <- x[[1]]\n  \n  map(x, function(x) {\n    \n    idx <- data.table(\n      code = x,\n      grp1 = sf_sub(x, 1, 2),\n      grp2 = sf_sub(x, 1, 3),\n      grp3 = sf_sub(x, 1, 4),\n      a1 = take_at(x),\n      a2 = take_at(x, 2),\n      a3 = take_at(x, 3),\n      a4 = take_at(x, 4),\n      a5 = take_at(x, 5),\n      i1 = groupid(take_at(x))) |>\n      fgroup_by(a1) |> \n      fmutate(i2 = groupid(a2)) |>\n      fgroup_by(a1, a2) |> \n      fmutate(i3 = groupid(a3)) |>\n      fgroup_by(a1, a2, a3) |> \n      fmutate(i4 = groupid(a4)) |>\n      fgroup_by(a1, a2, a3, a4) |> \n      fmutate(i5 = groupid(a5)) |> \n      fungroup()\n\n      lone <- fcount(idx, i1, add = TRUE) |> \n        fsubset((i2 + i3 + i4 + i5 + N) == 5)\n      \n      last <- fsubset(idx, code %!in% lone[[\"code\"]])\n      \n      last <- join(\n        fcount(last, grp2, a4),\n        fcount(last, grp2, name = \"G\"), on = \"grp2\", verbose = 0) |>\n        fsubset(N == G) |>\n        join(last, on = c(\"grp2\", \"a4\"), how = \"right\", verbose = 0) |> \n        fsubset(not_na(N))\n      \n      rest <- fsubset(idx, code %!in% c(lone[[\"code\"]], last[[\"code\"]]))\n      \n      c(if (empty(lone)) NULL else list(lone[[\"code\"]]),\n        if (empty(last)) NULL else gchop(last[[\"code\"]], last[[\"grp2\"]]),\n        if (empty(rest)) NULL else gchop(rest[[\"code\"]], rest[[\"grp3\"]]))\n    })\n}\n\nc(\"C7510\", \"C9701\", \"G0200\", \"G0400\") |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"C7510\"\n\n[[1]][[2]]\n[1] \"C9701\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"G0200\"\n\n[[2]][[2]]\n[1] \"G0400\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlong_test2[nchar(long_test2) == 5] |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"15777\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"20939\"\n\n[[2]][[2]]\n[1] \"27197\" \"27198\"\n\n[[2]][[3]]\n[1] \"22510\" \"22511\" \"22512\" \"22513\" \"22514\" \"22515\"\n\n[[2]][[4]]\n[1] \"22526\" \"22527\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"30801\" \"30802\"\n\n[[3]][[2]]\n[1] \"31231\"\n\n[[3]][[3]]\n[1] \"32673\"\n\n[[3]][[4]]\n[1] \"34713\" \"34714\" \"34715\" \"34716\" \"34717\"\n\n[[3]][[5]]\n[1] \"35572\"\n\n[[3]][[6]]\n[1] \"36221\"\n\n[[3]][[7]]\n[1] \"34812\"\n\n[[3]][[8]]\n[1] \"34820\"\n\n[[3]][[9]]\n[1] \"34833\" \"34834\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"50300\"\n\n[[4]][[2]]\n[1] \"50540\"\n\n[[4]][[3]]\n[1] \"55300\"\n\n[[4]][[4]]\n[1] \"58575\"\n\n[[4]][[5]]\n[1] \"58600\" \"58605\"\n\n[[4]][[6]]\n[1] \"58800\" \"58805\"\n\n[[4]][[7]]\n[1] \"54420\"\n\n[[4]][[8]]\n[1] \"54430\"\n\n[[4]][[9]]\n[1] \"55200\"\n\n[[4]][[10]]\n[1] \"55250\"\n\n[[4]][[11]]\n[1] \"58700\"\n\n[[4]][[12]]\n[1] \"58720\"\n\n[[4]][[13]]\n[1] \"58900\"\n\n[[4]][[14]]\n[1] \"58920\" \"58925\"\n\n[[4]][[15]]\n[1] \"58940\" \"58943\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"61000\" \"61001\"\n\n[[5]][[2]]\n[1] \"61253\"\n\n[[5]][[3]]\n[1] \"64634\" \"64636\"\n\n[[5]][[4]]\n[1] \"63035\"\n\n[[5]][[5]]\n[1] \"63043\" \"63044\" \"63045\" \"63046\" \"63047\" \"63048\"\n\n[[5]][[6]]\n[1] \"64421\"\n\n[[5]][[7]]\n[1] \"64480\" \"64484\"\n\n[[5]][[8]]\n[1] \"64491\" \"64492\" \"64494\" \"64495\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"76514\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"95870\"\n\n[[7]][[2]]\n[1] \"92025\"\n\n[[7]][[3]]\n[1] \"92081\" \"92082\" \"92083\"\n\n[[7]][[4]]\n[1] \"92132\" \"92133\" \"92134\"\n\n[[7]][[5]]\n[1] \"92145\"\n\n[[7]][[6]]\n[1] \"92201\" \"92202\"\n\n[[7]][[7]]\n[1] \"92227\" \"92228\" \"92229\"\n\n[[7]][[8]]\n[1] \"92235\"\n\n[[7]][[9]]\n[1] \"92240\" \"92242\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"C7501\" \"C7502\" \"C7504\" \"C7505\"\n\n[[8]][[2]]\n[1] \"C9771\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"E0675\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"G0279\"\n\n[[10]][[2]]\n[1] \"G0412\" \"G0413\" \"G0414\" \"G0415\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"S2342\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"0329T\"\n\n[[12]][[2]]\n[1] \"0330T\"\n\n[[12]][[3]]\n[1] \"0422T\"\n\n[[12]][[4]]\n[1] \"0214T\"\n\n[[12]][[5]]\n[1] \"0215T\"\n\n[[12]][[6]]\n[1] \"0217T\"\n\n[[12]][[7]]\n[1] \"0218T\"\n\n[[12]][[8]]\n[1] \"0219T\"\n\n[[12]][[9]]\n[1] \"0220T\"\n\n[[12]][[10]]\n[1] \"0221T\"\n\n[[12]][[11]]\n[1] \"0222T\"\n\n[[12]][[12]]\n[1] \"0263T\"\n\n[[12]][[13]]\n[1] \"0265T\"\n\n[[12]][[14]]\n[1] \"0266T\"\n\n[[12]][[15]]\n[1] \"0269T\"\n\n[[12]][[16]]\n[1] \"0274T\"\n\n[[12]][[17]]\n[1] \"0275T\"\n\n[[12]][[18]]\n[1] \"0444T\"\n\n[[12]][[19]]\n[1] \"0445T\"\n\n[[12]][[20]]\n[1] \"0506T\"\n\n[[12]][[21]]\n[1] \"0507T\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(30) |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  group_5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"10140\"\n\n[[1]][[2]]\n[1] \"11620\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"61783\"\n\n[[2]][[2]]\n[1] \"64704\"\n\n[[2]][[3]]\n[1] \"65222\"\n\n[[2]][[4]]\n[1] \"65785\"\n\n[[2]][[5]]\n[1] \"67715\"\n\n[[2]][[6]]\n[1] \"64616\"\n\n[[2]][[7]]\n[1] \"64643\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"78496\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"82286\"\n\n[[4]][[2]]\n[1] \"82436\"\n\n[[4]][[3]]\n[1] \"87516\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"92065\"\n\n[[5]][[2]]\n[1] \"96000\"\n\n[[5]][[3]]\n[1] \"99251\"\n\n[[5]][[4]]\n[1] \"99498\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"J1094\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"M1369\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"S2068\"\n\n[[8]][[2]]\n[1] \"S9975\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"0168U\"\n```\n\n\n:::\n:::\n\n\n\n\n## process_groups\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprocess_groups <- function(x) {\n  \n  list(\n    g1 = x$x1,\n    g2 = x$x2,\n    g3 = group_3(x),\n    g4 = group_4(x),\n    g5 = group_5(x)\n    )\n}\n\nhcpcs_tests |>\n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  process_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$g1\n$g1[[1]]\n[1] \"0\" \"4\" \"5\" \"6\" \"G\" \"J\"\n\n\n$g2\n$g2[[1]]\n[1] \"30\" \"31\" \"32\"\n\n\n$g3\n$g3[[1]]\n$g3[[1]][[1]]\n[1] \"721\" \"722\" \"723\" \"724\" \"725\" \"726\" \"727\" \"728\" \"729\"\n\n\n\n$g4\nlist()\n\n$g5\n$g5[[1]]\n$g5[[1]][[1]]\n[1] \"92015\" \"92016\" \"92017\" \"92018\" \"92019\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlong_test2 |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |> \n  process_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$g1\n$g1[[1]]\n [1] \"0\" \"1\" \"2\" \"3\" \"5\" \"6\" \"7\" \"9\" \"C\" \"E\" \"G\" \"S\"\n\n\n$g2\nlist()\n\n$g3\nlist()\n\n$g4\nlist()\n\n$g5\nlist()\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs(50) |> \n  split_lengths() |> \n  remove_redundant() |>\n  split_first() |>\n  process_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$g1\n$g1[[1]]\n[1] \"F\" \"J\" \"M\" \"T\" \"U\"\n\n\n$g2\n$g2[[1]]\n[1] \"00\" \"01\"\n\n$g2[[2]]\n[1] \"21\" \"24\" \"25\" \"26\" \"27\"\n\n$g2[[3]]\n[1] \"35\"\n\n$g2[[4]]\n[1] \"40\" \"42\"\n\n$g2[[5]]\n[1] \"52\" \"53\" \"54\"\n\n$g2[[6]]\n[1] \"63\" \"67\" \"69\"\n\n$g2[[7]]\n[1] \"76\" \"77\"\n\n$g2[[8]]\n[1] \"80\" \"81\" \"83\" \"84\" \"85\" \"87\"\n\n$g2[[9]]\n[1] \"90\"\n\n$g2[[10]]\n[1] \"A0\" \"A4\"\n\n$g2[[11]]\n[1] \"C9\"\n\n$g2[[12]]\n[1] \"G0\" \"G6\" \"G9\"\n\n$g2[[13]]\n[1] \"K0\"\n\n$g2[[14]]\n[1] \"L2\" \"L8\"\n\n$g2[[15]]\n[1] \"P9\"\n\n$g2[[16]]\n[1] \"Q2\" \"Q4\" \"Q5\"\n\n$g2[[17]]\n[1] \"S9\"\n\n$g2[[18]]\n[1] \"V2\"\n\n\n$g3\n$g3[[1]]\n$g3[[1]][[1]]\n[1] \"064\"\n\n\n$g3[[2]]\n$g3[[2]][[1]]\n[1] \"120\"\n\n$g3[[2]][[2]]\n[1] \"159\"\n\n\n$g3[[3]]\n$g3[[3]][[1]]\n[1] \"333\" \"334\"\n\n\n$g3[[4]]\n$g3[[4]][[1]]\n[1] \"431\"\n\n$g3[[4]][[2]]\n[1] \"469\"\n\n$g3[[4]][[3]]\n[1] \"475\"\n\n\n$g3[[5]]\n$g3[[5]][[1]]\n[1] \"508\"\n\n$g3[[5]][[2]]\n[1] \"574\"\n\n\n$g3[[6]]\n$g3[[6]][[1]]\n[1] \"644\"\n\n$g3[[6]][[2]]\n[1] \"685\"\n\n\n$g3[[7]]\n$g3[[7]][[1]]\n[1] \"737\"\n\n$g3[[7]][[2]]\n[1] \"755\"\n\n\n$g3[[8]]\n$g3[[8]][[1]]\n[1] \"989\"\n\n$g3[[8]][[2]]\n[1] \"993\"\n\n\n$g3[[9]]\n$g3[[9]][[1]]\n[1] \"A62\"\n\n$g3[[9]][[2]]\n[1] \"A70\"\n\n\n$g3[[10]]\n$g3[[10]][[1]]\n[1] \"G40\"\n\n$g3[[10]][[2]]\n[1] \"G89\"\n\n\n$g3[[11]]\n$g3[[11]][[1]]\n[1] \"L04\"\n\n$g3[[11]][[2]]\n[1] \"L39\"\n\n\n$g3[[12]]\n$g3[[12]][[1]]\n[1] \"S55\"\n\n\n\n$g4\n$g4[[1]]\n$g4[[1]][[1]]\n[1] \"0726\"\n\n$g4[[1]][[2]]\n[1] \"0767\"\n\n\n$g4[[2]]\n$g4[[2]][[1]]\n[1] \"1176\"\n\n\n$g4[[3]]\n$g4[[3]][[1]]\n[1] \"3491\"\n\n$g4[[3]][[2]]\n[1] \"3690\"\n\n\n$g4[[4]]\n$g4[[4]][[1]]\n[1] \"4159\"\n\n$g4[[4]][[2]]\n[1] \"4191\"\n\n\n$g4[[5]]\n$g4[[5]][[1]]\n[1] \"5855\"\n\n$g4[[5]][[2]]\n[1] \"5912\"\n\n\n$g4[[6]]\n$g4[[6]][[1]]\n[1] \"8926\"\n\n\n$g4[[7]]\n$g4[[7]][[1]]\n[1] \"9213\"\n\n$g4[[7]][[2]]\n[1] \"9330\" \"9331\"\n\n$g4[[7]][[3]]\n[1] \"9466\"\n\n\n$g4[[8]]\n$g4[[8]][[1]]\n[1] \"A659\"\n\n\n$g4[[9]]\n$g4[[9]][[1]]\n[1] \"E029\"\n\n$g4[[9]][[2]]\n[1] \"E124\"\n\n$g4[[9]][[3]]\n[1] \"E250\"\n\n\n$g4[[10]]\n$g4[[10]][[1]]\n[1] \"G812\"\n\n\n$g4[[11]]\n$g4[[11]][[1]]\n[1] \"L185\"\n\n$g4[[11]][[2]]\n[1] \"L301\"\n\n$g4[[11]][[3]]\n[1] \"L322\"\n\n\n$g4[[12]]\n$g4[[12]][[1]]\n[1] \"Q302\"\n\n$g4[[12]][[2]]\n[1] \"Q047\"\n\n$g4[[12]][[3]]\n[1] \"Q051\"\n\n\n\n$g5\n$g5[[1]]\n$g5[[1]][[1]]\n[1] \"20663\"\n\n$g5[[1]][[2]]\n[1] \"29834\"\n\n$g5[[1]][[3]]\n[1] \"29851\"\n\n\n$g5[[2]]\n$g5[[2]][[1]]\n[1] \"33948\"\n\n\n$g5[[3]]\n$g5[[3]][[1]]\n[1] \"43231\"\n\n$g5[[3]][[2]]\n[1] \"46604\"\n\n$g5[[3]][[3]]\n[1] \"46710\"\n\n$g5[[3]][[4]]\n[1] \"48000\"\n\n\n$g5[[4]]\n$g5[[4]][[1]]\n[1] \"61530\"\n\n$g5[[4]][[2]]\n[1] \"64734\"\n\n\n$g5[[5]]\n$g5[[5]][[1]]\n[1] \"78120\"\n\n\n$g5[[6]]\n$g5[[6]][[1]]\n[1] \"86644\"\n\n\n$g5[[7]]\n$g5[[7]][[1]]\n[1] \"92502\"\n\n$g5[[7]][[2]]\n[1] \"92626\"\n\n\n$g5[[8]]\n$g5[[8]][[1]]\n[1] \"C1758\"\n\n$g5[[8]][[2]]\n[1] \"C7512\"\n\n\n$g5[[9]]\n$g5[[9]][[1]]\n[1] \"E0434\"\n\n\n$g5[[10]]\n$g5[[10]][[1]]\n[1] \"L5653\"\n\n$g5[[10]][[2]]\n[1] \"L5822\"\n\n\n$g5[[11]]\n$g5[[11]][[1]]\n[1] \"Q0173\"\n\n\n$g5[[12]]\n$g5[[12]][[1]]\n[1] \"0207T\"\n```\n\n\n:::\n:::\n\n\n\n\n### Problems\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# 1\nlist(\"L80\", c(\"L56\", \"L59\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"L80\"\n\n[[2]]\n[1] \"L56\" \"L59\"\n```\n\n\n:::\n\n```{.r .cell-code}\n\"^L(5[69]|80)$\"\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^L(5[69]|80)$\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsf_extract(hcpcs, \"^L(5[69]|80)[0-9]{2}$\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  [1] \"L5600\" \"L5610\" \"L5611\" \"L5613\" \"L5614\" \"L5615\" \"L5616\" \"L5617\" \"L5618\"\n [10] \"L5620\" \"L5622\" \"L5624\" \"L5626\" \"L5628\" \"L5629\" \"L5630\" \"L5631\" \"L5632\"\n [19] \"L5634\" \"L5636\" \"L5637\" \"L5638\" \"L5639\" \"L5640\" \"L5642\" \"L5643\" \"L5644\"\n [28] \"L5645\" \"L5646\" \"L5647\" \"L5648\" \"L5649\" \"L5650\" \"L5651\" \"L5652\" \"L5653\"\n [37] \"L5654\" \"L5655\" \"L5656\" \"L5658\" \"L5661\" \"L5665\" \"L5666\" \"L5668\" \"L5670\"\n [46] \"L5671\" \"L5672\" \"L5673\" \"L5676\" \"L5677\" \"L5678\" \"L5679\" \"L5680\" \"L5681\"\n [55] \"L5682\" \"L5683\" \"L5684\" \"L5685\" \"L5686\" \"L5688\" \"L5690\" \"L5692\" \"L5694\"\n [64] \"L5695\" \"L5696\" \"L5697\" \"L5698\" \"L5699\" \"L5910\" \"L5920\" \"L5925\" \"L5926\"\n [73] \"L5930\" \"L5940\" \"L5950\" \"L5960\" \"L5961\" \"L5962\" \"L5964\" \"L5966\" \"L5968\"\n [82] \"L5969\" \"L5970\" \"L5971\" \"L5972\" \"L5973\" \"L5974\" \"L5975\" \"L5976\" \"L5978\"\n [91] \"L5979\" \"L5980\" \"L5981\" \"L5982\" \"L5984\" \"L5985\" \"L5986\" \"L5987\" \"L5988\"\n[100] \"L5990\" \"L5991\" \"L5999\" \"L8000\" \"L8001\" \"L8002\" \"L8010\" \"L8015\" \"L8020\"\n[109] \"L8030\" \"L8031\" \"L8032\" \"L8033\" \"L8035\" \"L8039\" \"L8040\" \"L8041\" \"L8042\"\n[118] \"L8043\" \"L8044\" \"L8045\" \"L8046\" \"L8047\" \"L8048\" \"L8049\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# 2\nlist(c(\"021\", \"022\", \"026\", \"027\"), c(\"032\", \"033\"), c(\"042\", \"044\"), \"050\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"021\" \"022\" \"026\" \"027\"\n\n[[2]]\n[1] \"032\" \"033\"\n\n[[3]]\n[1] \"042\" \"044\"\n\n[[4]]\n[1] \"050\"\n```\n\n\n:::\n\n```{.r .cell-code}\n\"^0(2[1267]|3[23]|4[24]|50)[A-Z0-9]{2}$\"\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^0(2[1267]|3[23]|4[24]|50)[A-Z0-9]{2}$\"\n```\n\n\n:::\n\n```{.r .cell-code}\nsf_extract(hcpcs, \"^0(2[1267]|3[23]|4[24]|50)[A-Z0-9]{2}$\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  [1] \"0210T\" \"0210U\" \"0211T\" \"0211U\" \"0212T\" \"0212U\" \"0213T\" \"0213U\" \"0214T\"\n [10] \"0214U\" \"0215T\" \"0215U\" \"0216T\" \"0216U\" \"0217T\" \"0217U\" \"0218T\" \"0218U\"\n [19] \"0219T\" \"0219U\" \"0220T\" \"0220U\" \"0221T\" \"0221U\" \"0222T\" \"0222U\" \"0223U\"\n [28] \"0224U\" \"0225U\" \"0226U\" \"0227U\" \"0228U\" \"0229U\" \"0260U\" \"0261U\" \"0262U\"\n [37] \"0263T\" \"0263U\" \"0264T\" \"0264U\" \"0265T\" \"0265U\" \"0266T\" \"0266U\" \"0267T\"\n [46] \"0267U\" \"0268T\" \"0268U\" \"0269T\" \"0269U\" \"0270T\" \"0270U\" \"0271T\" \"0271U\"\n [55] \"0272T\" \"0272U\" \"0273T\" \"0273U\" \"0274T\" \"0274U\" \"0275T\" \"0275U\" \"0276U\"\n [64] \"0277U\" \"0278T\" \"0278U\" \"0279U\" \"0320U\" \"0321U\" \"0322U\" \"0323U\" \"0324U\"\n [73] \"0325U\" \"0326U\" \"0327U\" \"0328U\" \"0329T\" \"0329U\" \"0330T\" \"0330U\" \"0331T\"\n [82] \"0331U\" \"0332T\" \"0332U\" \"0333T\" \"0333U\" \"0334U\" \"0335T\" \"0335U\" \"0336U\"\n [91] \"0337U\" \"0338T\" \"0338U\" \"0339T\" \"0339U\" \"0420T\" \"0421T\" \"0422T\" \"0424T\"\n[100] \"0425T\" \"0426T\" \"0427T\" \"0428T\" \"0429T\" \"0440T\" \"0441T\" \"0442T\" \"0443T\"\n[109] \"0444T\" \"0445T\" \"0446T\" \"0447T\" \"0448T\" \"0449T\" \"0500F\" \"0500T\" \"0501F\"\n[118] \"0501T\" \"0502F\" \"0502T\" \"0503F\" \"0503T\" \"0504T\" \"0505F\" \"0505T\" \"0506T\"\n[127] \"0507F\" \"0507T\" \"0508T\" \"0509F\" \"0509T\"\n```\n\n\n:::\n\n```{.r .cell-code}\n#---------- 3\nlist(c(\"C75\", \"C97\"), c(\"G02\", \"G04\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"C75\" \"C97\"\n\n[[2]]\n[1] \"G02\" \"G04\"\n```\n\n\n:::\n\n```{.r .cell-code}\n\"^C(75|97)[A-Z0-9]{2}$\"\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^C(75|97)[A-Z0-9]{2}$\"\n```\n\n\n:::\n\n```{.r .cell-code}\n\"^G0[24][A-Z0-9]{2}$\"\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^G0[24][A-Z0-9]{2}$\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, \"^C(75|97)[0-9]{2}$|^G0[24][0-9]{2}$\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 253\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, \"^(C75|C97|G0[24])[0-9]{2}$\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 253\n```\n\n\n:::\n\n```{.r .cell-code}\n# red2() output\nlist(\"0[2-5]\", \"15\", \"2[027]\", \"3[0-24-6]\", \"5[0458]\", \"6[134]\", \"76\", \"9[25]\", \"C[79]\", \"E0\", \"G0\", \"S2\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"0[2-5]\"\n\n[[2]]\n[1] \"15\"\n\n[[3]]\n[1] \"2[027]\"\n\n[[4]]\n[1] \"3[0-24-6]\"\n\n[[5]]\n[1] \"5[0458]\"\n\n[[6]]\n[1] \"6[134]\"\n\n[[7]]\n[1] \"76\"\n\n[[8]]\n[1] \"9[25]\"\n\n[[9]]\n[1] \"C[79]\"\n\n[[10]]\n[1] \"E0\"\n\n[[11]]\n[1] \"G0\"\n\n[[12]]\n[1] \"S2\"\n```\n\n\n:::\n\n```{.r .cell-code}\n# solution\nred2test <- paste0(\n  \"^(\", \n  sf_collapse(\n    list(\"0[2-5]\", \"15\", \"2[027]\", \"3[0-24-6]\", \"5[0458]\", \"6[134]\", \"76\", \"9[25]\", \"C[79]\", \"E0\", \"G0\", \"S2\") |> \n      purrr::list_c(), \n    collapse = \"|\"), \n  \")[A-Z0-9]{3}$\")\n\nred2test\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^(0[2-5]|15|2[027]|3[0-24-6]|5[0458]|6[134]|76|9[25]|C[79]|E0|G0|S2)[A-Z0-9]{3}$\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlength(sf_extract(hcpcs, red2test))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4349\n```\n\n\n:::\n:::\n\n\n\n\n::: \n\n# Reduction\n\n::: {.panel-tabset}\n\n## `reduce_runs()`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlength_gto <- \\(x) length(x) > 1\nlength_eto <- \\(x) length(x) == 1\n\nreduce_runs <- function(x) {\n  \n  if (sf_nchar(x) == 1) return(x)\n\n  test <- setNames(rep(0, 37), c(0:9, \"&\", LETTERS))\n  \n  vec <- test[c(splits(x), \"&\")]\n  \n  vec <- vec[not_na(vec)]\n  \n  test[names(vec)] <- 1\n  \n  test[names(test) == \"&\"] <- 0\n\n  groups <- data.table(\n    value = names(test),\n    keys = test,\n    group = groupid(test)) |>\n    fgroup_by(group)\n  \n  groups <- join(\n    groups, \n    fcount(groups, group), \n    on = \"group\", \n    verbose = 0) |> \n    fungroup() |> \n    fsubset(keys == 1) |>\n    fsubset(N >= 3) |>\n    fselect(value, group)\n    \n  if (empty(groups)) return(x)\n  \n  xgroups <- gchop(groups$value, \n                   groups$group) |>\n    map(smush) |>\n    list_c()\n  \n  if (all(xgroups == smush(c(0:9, \"&\", LETTERS)))) return(\"[A-Z0-9]\")\n  \n  replacements <- dplyr::left_join(\n    dplyr::slice_min(groups, by = group, order_by = value) |> dplyr::rename(start = value),\n    dplyr::slice_max(groups, by = group, order_by = value) |> dplyr::rename(end = value),\n    by = dplyr::join_by(group)) |>\n    glue::glue_data(\"{start}-{end}\") |>\n    as.vector()\n\n  res <- stringi::stri_replace_all_regex(x, xgroups, replacements, vectorize_all = FALSE)\n\n  bracket(res)\n}\n```\n:::\n\n\n\n\n## `red1()`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# return(glue::glue(\"^{re}{{5}}$\"))\n# glue::glue(\"^{re}{post}{{4}}$\")\n\nred1 <- function(x) {\n  \n  x <- getelem(x, \"g1\")[[1]]\n  \n  if (empty(x)) return(character(0))\n  \n  re <- sort_order(x) |> reduce_runs()\n  \n  if (re == \"[A-Z0-9]\") return(paste0(\"^\", re, \"{5}$\"))\n  \n  post <- iif_else(sf_detect(re, \"\\\\[?[0-9]{1}\"), \"[A-Z0-9]\", \"[0-9]\")\n  \n  paste0(\"^\", re, post, \"{4}\")\n}\n\nlong_test2 |>\n  split_lengths() |> \n  remove_redundant() |> \n  split_first() |>\n  process_groups() |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^[CEGS0-35-79][A-Z0-9]{4}\"\n```\n\n\n:::\n\n```{.r .cell-code}\nhcpcs_tests |> \n  split_lengths() |> \n  remove_redundant() |> \n  split_first() |>\n  process_groups() |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^[GJ04-6][A-Z0-9]{4}\"\n```\n\n\n:::\n\n```{.r .cell-code}\nc(LETTERS[1:5], 0:9) |> \n  split_lengths() |> \n  remove_redundant() |> \n  split_first() |>\n  process_groups() |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^[A-E0-9][A-Z0-9]{4}\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlist(g1 = list(c(0:9, LETTERS))) |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^[A-Z0-9]{5}$\"\n```\n\n\n:::\n\n```{.r .cell-code}\nlist(g1 = list(c(LETTERS[1:5], 0:9))) |> \n  red1()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^[A-E0-9][A-Z0-9]{4}\"\n```\n\n\n:::\n:::\n\n\n\n\n## `red2()`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred2 <- function(x) {\n  \n  x <- getelem(x, \"g2\")\n  \n  if (empty(x)) return(character(0))\n  \n  modify_if(x, length_gto, function(x) {\n    \n    parts <- stringr::str_split_fixed(x, \"\", max_vlen(x)) |> \n    as.data.frame() |>\n    map(uniq_narm) |>\n    map(sort_order) |>\n    map(reduce_runs) |>\n    delist()\n\n  multi <- sf_nchar(parts) > 1\n  nobrk <- !sf_detect(parts[multi], \"\\\\[|\\\\]\")\n  \n  parts[multi] <- iif_else(\n    any(nobrk), \n    map_chr(parts[multi], bracket), \n    parts[multi])\n  \n  smush(parts)\n  })\n}\n\nlong_test2[sf_nchar(long_test2) == 2] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  red2()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"0[2-5]\"\n\n[[2]]\n[1] \"15\"\n\n[[3]]\n[1] \"2[027]\"\n\n[[4]]\n[1] \"3[0-24-6]\"\n\n[[5]]\n[1] \"5[0458]\"\n\n[[6]]\n[1] \"6[134]\"\n\n[[7]]\n[1] \"76\"\n\n[[8]]\n[1] \"9[25]\"\n\n[[9]]\n[1] \"C[79]\"\n\n[[10]]\n[1] \"E0\"\n\n[[11]]\n[1] \"G0\"\n\n[[12]]\n[1] \"S2\"\n```\n\n\n:::\n\n```{.r .cell-code}\npaste0(\"A\", c(0:5, LETTERS)) |> \n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  red2()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"A[A-Z0-5]\"\n```\n\n\n:::\n:::\n\n\n\n\n## `red3()`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred3 <- function(x) {\n  \n  x <- getelem(x, \"g3\")\n  \n  if (empty(x)) return(character(0))\n  \n  map(x, function(x) {\n    \n    modify_if(x, length_gto, function(x) {\n      \n      parts <- stringr::str_split_fixed(x, \"\", n = max_vlen(x)) |> \n        as.data.frame() |>\n        map(uniq_narm) |> \n        map(sort_order) |>\n        map(reduce_runs) |> \n        delist()\n      \n      multi <- sf_nchar(parts) > 1\n      nobrk <- !sf_detect(parts[multi], \"\\\\[|\\\\]\")\n      \n      parts[multi] <- iif_else(any(nobrk), map_chr(parts[multi], bracket), parts[multi])\n      smush(parts)\n    })\n  })\n}\n\nlong_test2[sf_nchar(long_test2) == 3] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  red3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"02[1267]\"\n\n[[1]][[2]]\n[1] \"03[23]\"\n\n[[1]][[3]]\n[1] \"04[24]\"\n\n[[1]][[4]]\n[1] \"050\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"157\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"209\"\n\n[[3]][[2]]\n[1] \"225\"\n\n[[3]][[3]]\n[1] \"271\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"308\"\n\n[[4]][[2]]\n[1] \"312\"\n\n[[4]][[3]]\n[1] \"326\"\n\n[[4]][[4]]\n[1] \"34[78]\"\n\n[[4]][[5]]\n[1] \"355\"\n\n[[4]][[6]]\n[1] \"362\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"50[35]\"\n\n[[5]][[2]]\n[1] \"544\"\n\n[[5]][[3]]\n[1] \"55[23]\"\n\n[[5]][[4]]\n[1] \"58[5-9]\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"61[02]\"\n\n[[6]][[2]]\n[1] \"630\"\n\n[[6]][[3]]\n[1] \"64[46]\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"765\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"92[0-2]\"\n\n[[8]][[2]]\n[1] \"958\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C75\"\n\n[[9]][[2]]\n[1] \"C97\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E06\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G0[24]\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S23\"\n```\n\n\n:::\n:::\n\n\n\n\n## `red4()`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred4 <- function(x) {\n  \n  x <- getelem(x, \"g4\")\n  \n  if (empty(x)) return(character(0))\n  \n  map(x, function(x) {\n    \n    modify_if(x, length_gto, function(x) {\n      \n      parts <- stringr::str_split_fixed(x, \"\", n = max_vlen(x)) |> \n        as.data.frame() |>\n        map(uniq_narm) |> \n        map(sort_order) |>\n        map(reduce_runs) |> \n        delist()\n      \n      multi <- sf_nchar(parts) > 1\n      nobrk <- !sf_detect(parts[multi], \"\\\\[|\\\\]\")\n      \n      parts[multi] <- iif_else(any(nobrk), map_chr(parts[multi], bracket), parts[multi])\n      smush(parts)\n    })\n  })\n}\n\nlong_test2[sf_nchar(long_test2) == 4] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  red4()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"050[67]\"\n\n[[1]][[2]]\n[1] \"021[457-9]\"\n\n[[1]][[3]]\n[1] \"022[0-2]\"\n\n[[1]][[4]]\n[1] \"026[3569]\"\n\n[[1]][[5]]\n[1] \"027[45]\"\n\n[[1]][[6]]\n[1] \"0329\"\n\n[[1]][[7]]\n[1] \"0330\"\n\n[[1]][[8]]\n[1] \"0422\"\n\n[[1]][[9]]\n[1] \"044[45]\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"1577\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"2093\"\n\n[[3]][[2]]\n[1] \"225[12]\"\n\n[[3]][[3]]\n[1] \"2719\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"3080\"\n\n[[4]][[2]]\n[1] \"3123\"\n\n[[4]][[3]]\n[1] \"3267\"\n\n[[4]][[4]]\n[1] \"3557\"\n\n[[4]][[5]]\n[1] \"3622\"\n\n[[4]][[6]]\n[1] \"3471\"\n\n[[4]][[7]]\n[1] \"348[1-3]\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"544[23]\"\n\n[[5]][[2]]\n[1] \"5030\"\n\n[[5]][[3]]\n[1] \"5054\"\n\n[[5]][[4]]\n[1] \"552[05]\"\n\n[[5]][[5]]\n[1] \"5530\"\n\n[[5]][[6]]\n[1] \"5857\"\n\n[[5]][[7]]\n[1] \"5860\"\n\n[[5]][[8]]\n[1] \"587[02]\"\n\n[[5]][[9]]\n[1] \"5880\"\n\n[[5]][[10]]\n[1] \"589[024]\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"630[34]\"\n\n[[6]][[2]]\n[1] \"6100\"\n\n[[6]][[3]]\n[1] \"6125\"\n\n[[6]][[4]]\n[1] \"644[289]\"\n\n[[6]][[5]]\n[1] \"6463\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"7651\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"9587\"\n\n[[8]][[2]]\n[1] \"920[28]\"\n\n[[8]][[3]]\n[1] \"921[34]\"\n\n[[8]][[4]]\n[1] \"922[02-4]\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"C750\"\n\n[[9]][[2]]\n[1] \"C977\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"E067\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"G027\"\n\n[[11]][[2]]\n[1] \"G041\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"S234\"\n```\n\n\n:::\n:::\n\n\n\n\n## `red5()`\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nred5 <- function(x) {\n  \n  x <- getelem(x, \"g5\")\n  \n  if (empty(x)) return(character(0))\n  \n  map(x, function(x) {\n    \n    modify_if(x, length_gto, function(x) {\n      \n      parts <- stringr::str_split_fixed(x, \"\", n = max_vlen(x)) |> \n        as.data.frame() |>\n        map(uniq_narm) |> \n        map(sort_order) |>\n        map(reduce_runs) |> \n        delist()\n      \n      multi <- sf_nchar(parts) > 1\n      nobrk <- !sf_detect(parts[multi], \"\\\\[|\\\\]\")\n      \n      parts[multi] <- iif_else(any(nobrk), map_chr(parts[multi], bracket), parts[multi])\n      smush(parts)\n    })\n  })\n}\n\nlong_test2[sf_nchar(long_test2) == 5] |>\n  split_lengths() |>\n  # remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  red5()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[[1]][[1]]\n[1] \"15777\"\n\n\n[[2]]\n[[2]][[1]]\n[1] \"20939\"\n\n[[2]][[2]]\n[1] \"2719[78]\"\n\n[[2]][[3]]\n[1] \"2251[0-5]\"\n\n[[2]][[4]]\n[1] \"2252[67]\"\n\n\n[[3]]\n[[3]][[1]]\n[1] \"3080[12]\"\n\n[[3]][[2]]\n[1] \"31231\"\n\n[[3]][[3]]\n[1] \"32673\"\n\n[[3]][[4]]\n[1] \"3471[3-7]\"\n\n[[3]][[5]]\n[1] \"35572\"\n\n[[3]][[6]]\n[1] \"36221\"\n\n[[3]][[7]]\n[1] \"34812\"\n\n[[3]][[8]]\n[1] \"34820\"\n\n[[3]][[9]]\n[1] \"3483[34]\"\n\n\n[[4]]\n[[4]][[1]]\n[1] \"50300\"\n\n[[4]][[2]]\n[1] \"50540\"\n\n[[4]][[3]]\n[1] \"55300\"\n\n[[4]][[4]]\n[1] \"58575\"\n\n[[4]][[5]]\n[1] \"5860[05]\"\n\n[[4]][[6]]\n[1] \"5880[05]\"\n\n[[4]][[7]]\n[1] \"54420\"\n\n[[4]][[8]]\n[1] \"54430\"\n\n[[4]][[9]]\n[1] \"55200\"\n\n[[4]][[10]]\n[1] \"55250\"\n\n[[4]][[11]]\n[1] \"58700\"\n\n[[4]][[12]]\n[1] \"58720\"\n\n[[4]][[13]]\n[1] \"58900\"\n\n[[4]][[14]]\n[1] \"5892[05]\"\n\n[[4]][[15]]\n[1] \"5894[03]\"\n\n\n[[5]]\n[[5]][[1]]\n[1] \"6100[01]\"\n\n[[5]][[2]]\n[1] \"61253\"\n\n[[5]][[3]]\n[1] \"6463[46]\"\n\n[[5]][[4]]\n[1] \"63035\"\n\n[[5]][[5]]\n[1] \"6304[3-8]\"\n\n[[5]][[6]]\n[1] \"64421\"\n\n[[5]][[7]]\n[1] \"6448[04]\"\n\n[[5]][[8]]\n[1] \"6449[1245]\"\n\n\n[[6]]\n[[6]][[1]]\n[1] \"76514\"\n\n\n[[7]]\n[[7]][[1]]\n[1] \"95870\"\n\n[[7]][[2]]\n[1] \"92025\"\n\n[[7]][[3]]\n[1] \"9208[1-3]\"\n\n[[7]][[4]]\n[1] \"9213[2-4]\"\n\n[[7]][[5]]\n[1] \"92145\"\n\n[[7]][[6]]\n[1] \"9220[12]\"\n\n[[7]][[7]]\n[1] \"9222[7-9]\"\n\n[[7]][[8]]\n[1] \"92235\"\n\n[[7]][[9]]\n[1] \"9224[02]\"\n\n\n[[8]]\n[[8]][[1]]\n[1] \"C750[1245]\"\n\n[[8]][[2]]\n[1] \"C9771\"\n\n\n[[9]]\n[[9]][[1]]\n[1] \"E0675\"\n\n\n[[10]]\n[[10]][[1]]\n[1] \"G0279\"\n\n[[10]][[2]]\n[1] \"G041[2-5]\"\n\n\n[[11]]\n[[11]][[1]]\n[1] \"S2342\"\n\n\n[[12]]\n[[12]][[1]]\n[1] \"0329T\"\n\n[[12]][[2]]\n[1] \"0330T\"\n\n[[12]][[3]]\n[1] \"0422T\"\n\n[[12]][[4]]\n[1] \"0214T\"\n\n[[12]][[5]]\n[1] \"0215T\"\n\n[[12]][[6]]\n[1] \"0217T\"\n\n[[12]][[7]]\n[1] \"0218T\"\n\n[[12]][[8]]\n[1] \"0219T\"\n\n[[12]][[9]]\n[1] \"0220T\"\n\n[[12]][[10]]\n[1] \"0221T\"\n\n[[12]][[11]]\n[1] \"0222T\"\n\n[[12]][[12]]\n[1] \"0263T\"\n\n[[12]][[13]]\n[1] \"0265T\"\n\n[[12]][[14]]\n[1] \"0266T\"\n\n[[12]][[15]]\n[1] \"0269T\"\n\n[[12]][[16]]\n[1] \"0274T\"\n\n[[12]][[17]]\n[1] \"0275T\"\n\n[[12]][[18]]\n[1] \"0444T\"\n\n[[12]][[19]]\n[1] \"0445T\"\n\n[[12]][[20]]\n[1] \"0506T\"\n\n[[12]][[21]]\n[1] \"0507T\"\n```\n\n\n:::\n:::\n\n\n\n\n## reduce_groups\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nreduce_groups <- \\(x) {\n  \n  list(\n    g1 = red1(x),\n    g2 = red2(x),\n    g3 = red3(x),\n    g4 = red4(x),\n    g5 = red5(x)\n  )\n}\n\nlong_test2 |>\n  split_lengths() |>\n  # remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  reduce_groups()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$g1\n[1] \"^[CEGS0-35-79][A-Z0-9]{4}\"\n\n$g2\n$g2[[1]]\n[1] \"0[2-5]\"\n\n$g2[[2]]\n[1] \"15\"\n\n$g2[[3]]\n[1] \"2[027]\"\n\n$g2[[4]]\n[1] \"3[0-24-6]\"\n\n$g2[[5]]\n[1] \"5[0458]\"\n\n$g2[[6]]\n[1] \"6[134]\"\n\n$g2[[7]]\n[1] \"76\"\n\n$g2[[8]]\n[1] \"9[25]\"\n\n$g2[[9]]\n[1] \"C[79]\"\n\n$g2[[10]]\n[1] \"E0\"\n\n$g2[[11]]\n[1] \"G0\"\n\n$g2[[12]]\n[1] \"S2\"\n\n\n$g3\n$g3[[1]]\n$g3[[1]][[1]]\n[1] \"02[1267]\"\n\n$g3[[1]][[2]]\n[1] \"03[23]\"\n\n$g3[[1]][[3]]\n[1] \"04[24]\"\n\n$g3[[1]][[4]]\n[1] \"050\"\n\n\n$g3[[2]]\n$g3[[2]][[1]]\n[1] \"157\"\n\n\n$g3[[3]]\n$g3[[3]][[1]]\n[1] \"209\"\n\n$g3[[3]][[2]]\n[1] \"225\"\n\n$g3[[3]][[3]]\n[1] \"271\"\n\n\n$g3[[4]]\n$g3[[4]][[1]]\n[1] \"308\"\n\n$g3[[4]][[2]]\n[1] \"312\"\n\n$g3[[4]][[3]]\n[1] \"326\"\n\n$g3[[4]][[4]]\n[1] \"34[78]\"\n\n$g3[[4]][[5]]\n[1] \"355\"\n\n$g3[[4]][[6]]\n[1] \"362\"\n\n\n$g3[[5]]\n$g3[[5]][[1]]\n[1] \"50[35]\"\n\n$g3[[5]][[2]]\n[1] \"544\"\n\n$g3[[5]][[3]]\n[1] \"55[23]\"\n\n$g3[[5]][[4]]\n[1] \"58[5-9]\"\n\n\n$g3[[6]]\n$g3[[6]][[1]]\n[1] \"61[02]\"\n\n$g3[[6]][[2]]\n[1] \"630\"\n\n$g3[[6]][[3]]\n[1] \"64[46]\"\n\n\n$g3[[7]]\n$g3[[7]][[1]]\n[1] \"765\"\n\n\n$g3[[8]]\n$g3[[8]][[1]]\n[1] \"92[0-2]\"\n\n$g3[[8]][[2]]\n[1] \"958\"\n\n\n$g3[[9]]\n$g3[[9]][[1]]\n[1] \"C75\"\n\n$g3[[9]][[2]]\n[1] \"C97\"\n\n\n$g3[[10]]\n$g3[[10]][[1]]\n[1] \"E06\"\n\n\n$g3[[11]]\n$g3[[11]][[1]]\n[1] \"G0[24]\"\n\n\n$g3[[12]]\n$g3[[12]][[1]]\n[1] \"S23\"\n\n\n\n$g4\n$g4[[1]]\n$g4[[1]][[1]]\n[1] \"050[67]\"\n\n$g4[[1]][[2]]\n[1] \"021[457-9]\"\n\n$g4[[1]][[3]]\n[1] \"022[0-2]\"\n\n$g4[[1]][[4]]\n[1] \"026[3569]\"\n\n$g4[[1]][[5]]\n[1] \"027[45]\"\n\n$g4[[1]][[6]]\n[1] \"0329\"\n\n$g4[[1]][[7]]\n[1] \"0330\"\n\n$g4[[1]][[8]]\n[1] \"0422\"\n\n$g4[[1]][[9]]\n[1] \"044[45]\"\n\n\n$g4[[2]]\n$g4[[2]][[1]]\n[1] \"1577\"\n\n\n$g4[[3]]\n$g4[[3]][[1]]\n[1] \"2093\"\n\n$g4[[3]][[2]]\n[1] \"225[12]\"\n\n$g4[[3]][[3]]\n[1] \"2719\"\n\n\n$g4[[4]]\n$g4[[4]][[1]]\n[1] \"3080\"\n\n$g4[[4]][[2]]\n[1] \"3123\"\n\n$g4[[4]][[3]]\n[1] \"3267\"\n\n$g4[[4]][[4]]\n[1] \"3557\"\n\n$g4[[4]][[5]]\n[1] \"3622\"\n\n$g4[[4]][[6]]\n[1] \"3471\"\n\n$g4[[4]][[7]]\n[1] \"348[1-3]\"\n\n\n$g4[[5]]\n$g4[[5]][[1]]\n[1] \"544[23]\"\n\n$g4[[5]][[2]]\n[1] \"5030\"\n\n$g4[[5]][[3]]\n[1] \"5054\"\n\n$g4[[5]][[4]]\n[1] \"552[05]\"\n\n$g4[[5]][[5]]\n[1] \"5530\"\n\n$g4[[5]][[6]]\n[1] \"5857\"\n\n$g4[[5]][[7]]\n[1] \"5860\"\n\n$g4[[5]][[8]]\n[1] \"587[02]\"\n\n$g4[[5]][[9]]\n[1] \"5880\"\n\n$g4[[5]][[10]]\n[1] \"589[024]\"\n\n\n$g4[[6]]\n$g4[[6]][[1]]\n[1] \"630[34]\"\n\n$g4[[6]][[2]]\n[1] \"6100\"\n\n$g4[[6]][[3]]\n[1] \"6125\"\n\n$g4[[6]][[4]]\n[1] \"644[289]\"\n\n$g4[[6]][[5]]\n[1] \"6463\"\n\n\n$g4[[7]]\n$g4[[7]][[1]]\n[1] \"7651\"\n\n\n$g4[[8]]\n$g4[[8]][[1]]\n[1] \"9587\"\n\n$g4[[8]][[2]]\n[1] \"920[28]\"\n\n$g4[[8]][[3]]\n[1] \"921[34]\"\n\n$g4[[8]][[4]]\n[1] \"922[02-4]\"\n\n\n$g4[[9]]\n$g4[[9]][[1]]\n[1] \"C750\"\n\n$g4[[9]][[2]]\n[1] \"C977\"\n\n\n$g4[[10]]\n$g4[[10]][[1]]\n[1] \"E067\"\n\n\n$g4[[11]]\n$g4[[11]][[1]]\n[1] \"G027\"\n\n$g4[[11]][[2]]\n[1] \"G041\"\n\n\n$g4[[12]]\n$g4[[12]][[1]]\n[1] \"S234\"\n\n\n\n$g5\n$g5[[1]]\n$g5[[1]][[1]]\n[1] \"15777\"\n\n\n$g5[[2]]\n$g5[[2]][[1]]\n[1] \"20939\"\n\n$g5[[2]][[2]]\n[1] \"2719[78]\"\n\n$g5[[2]][[3]]\n[1] \"2251[0-5]\"\n\n$g5[[2]][[4]]\n[1] \"2252[67]\"\n\n\n$g5[[3]]\n$g5[[3]][[1]]\n[1] \"3080[12]\"\n\n$g5[[3]][[2]]\n[1] \"31231\"\n\n$g5[[3]][[3]]\n[1] \"32673\"\n\n$g5[[3]][[4]]\n[1] \"3471[3-7]\"\n\n$g5[[3]][[5]]\n[1] \"35572\"\n\n$g5[[3]][[6]]\n[1] \"36221\"\n\n$g5[[3]][[7]]\n[1] \"34812\"\n\n$g5[[3]][[8]]\n[1] \"34820\"\n\n$g5[[3]][[9]]\n[1] \"3483[34]\"\n\n\n$g5[[4]]\n$g5[[4]][[1]]\n[1] \"50300\"\n\n$g5[[4]][[2]]\n[1] \"50540\"\n\n$g5[[4]][[3]]\n[1] \"55300\"\n\n$g5[[4]][[4]]\n[1] \"58575\"\n\n$g5[[4]][[5]]\n[1] \"5860[05]\"\n\n$g5[[4]][[6]]\n[1] \"5880[05]\"\n\n$g5[[4]][[7]]\n[1] \"54420\"\n\n$g5[[4]][[8]]\n[1] \"54430\"\n\n$g5[[4]][[9]]\n[1] \"55200\"\n\n$g5[[4]][[10]]\n[1] \"55250\"\n\n$g5[[4]][[11]]\n[1] \"58700\"\n\n$g5[[4]][[12]]\n[1] \"58720\"\n\n$g5[[4]][[13]]\n[1] \"58900\"\n\n$g5[[4]][[14]]\n[1] \"5892[05]\"\n\n$g5[[4]][[15]]\n[1] \"5894[03]\"\n\n\n$g5[[5]]\n$g5[[5]][[1]]\n[1] \"6100[01]\"\n\n$g5[[5]][[2]]\n[1] \"61253\"\n\n$g5[[5]][[3]]\n[1] \"6463[46]\"\n\n$g5[[5]][[4]]\n[1] \"63035\"\n\n$g5[[5]][[5]]\n[1] \"6304[3-8]\"\n\n$g5[[5]][[6]]\n[1] \"64421\"\n\n$g5[[5]][[7]]\n[1] \"6448[04]\"\n\n$g5[[5]][[8]]\n[1] \"6449[1245]\"\n\n\n$g5[[6]]\n$g5[[6]][[1]]\n[1] \"76514\"\n\n\n$g5[[7]]\n$g5[[7]][[1]]\n[1] \"95870\"\n\n$g5[[7]][[2]]\n[1] \"92025\"\n\n$g5[[7]][[3]]\n[1] \"9208[1-3]\"\n\n$g5[[7]][[4]]\n[1] \"9213[2-4]\"\n\n$g5[[7]][[5]]\n[1] \"92145\"\n\n$g5[[7]][[6]]\n[1] \"9220[12]\"\n\n$g5[[7]][[7]]\n[1] \"9222[7-9]\"\n\n$g5[[7]][[8]]\n[1] \"92235\"\n\n$g5[[7]][[9]]\n[1] \"9224[02]\"\n\n\n$g5[[8]]\n$g5[[8]][[1]]\n[1] \"C750[1245]\"\n\n$g5[[8]][[2]]\n[1] \"C9771\"\n\n\n$g5[[9]]\n$g5[[9]][[1]]\n[1] \"E0675\"\n\n\n$g5[[10]]\n$g5[[10]][[1]]\n[1] \"G0279\"\n\n$g5[[10]][[2]]\n[1] \"G041[2-5]\"\n\n\n$g5[[11]]\n$g5[[11]][[1]]\n[1] \"S2342\"\n\n\n$g5[[12]]\n$g5[[12]][[1]]\n[1] \"0329T\"\n\n$g5[[12]][[2]]\n[1] \"0330T\"\n\n$g5[[12]][[3]]\n[1] \"0422T\"\n\n$g5[[12]][[4]]\n[1] \"0214T\"\n\n$g5[[12]][[5]]\n[1] \"0215T\"\n\n$g5[[12]][[6]]\n[1] \"0217T\"\n\n$g5[[12]][[7]]\n[1] \"0218T\"\n\n$g5[[12]][[8]]\n[1] \"0219T\"\n\n$g5[[12]][[9]]\n[1] \"0220T\"\n\n$g5[[12]][[10]]\n[1] \"0221T\"\n\n$g5[[12]][[11]]\n[1] \"0222T\"\n\n$g5[[12]][[12]]\n[1] \"0263T\"\n\n$g5[[12]][[13]]\n[1] \"0265T\"\n\n$g5[[12]][[14]]\n[1] \"0266T\"\n\n$g5[[12]][[15]]\n[1] \"0269T\"\n\n$g5[[12]][[16]]\n[1] \"0274T\"\n\n$g5[[12]][[17]]\n[1] \"0275T\"\n\n$g5[[12]][[18]]\n[1] \"0444T\"\n\n$g5[[12]][[19]]\n[1] \"0445T\"\n\n$g5[[12]][[20]]\n[1] \"0506T\"\n\n$g5[[12]][[21]]\n[1] \"0507T\"\n```\n\n\n:::\n:::\n\n\n\n\n\n::: \n\n# Recombination\n\n::: {.panel-tabset}\n\n## recomb2\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrecomb2 <- function(x) {\n  \n  x <- getelem(x, \"g2\")\n  \n  if (empty(x)) return(character(0))\n  \n  sf_convert(paste0(\"^(\", sf_collapse(list_c(x), collapse = \"|\"), \")[A-Z0-9]{3}$\"))\n}\n\nlong_test2[sf_nchar(long_test2) == 2] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |> \n  recomb2()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^(0[2-5]|15|2[027]|3[0-24-6]|5[0458]|6[134]|76|9[25]|C[79]|E0|G0|S2)[A-Z0-9]{3}$\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs() |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |> \n  recomb2()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"^(00|62|9[39]|A4|C1|G6|Q4)[A-Z0-9]{3}$\"\n```\n\n\n:::\n:::\n\n\n\n\n## recomb3\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrecomb3 <- function(x) {\n  \n  x <- getelem(x, \"g3\")\n  \n  if (empty(x)) return(character(0))\n  \n  single <- if (!empty(x[vlen(x) == 1])) {\n    \n    sf_convert(paste0(\"^\", list_c(x[vlen(x) == 1]), \"[A-Z0-9]{2}$\")) \n    \n    } else { \n    \n      character(0) \n    }\n  \n  family <- if (!empty(x[vlen(x) > 1])) { \n    \n    map(x[vlen(x) > 1], function(x) {\n      \n       front <- uniq(sf_sub(delist(x), start = 1, stop = 1))\n        \n        sf_convert(\n          paste0(\n          \"^\", \n          front, \n          \"(\", \n          sf_collapse(\n          sf_remove(\n          delist(x), \n          paste0(\"^[\", front, \"]{1}\")), \n          collapse = \"|\"), \n          \")[A-Z0-9]{2}$\"\n          ))\n      \n    })\n    \n    } else { \n      \n      character(0) \n    \n    }\n  \n  c(single, family)\n}\n\nlong_test2[sf_nchar(long_test2) == 3] |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |> \n  reduce_groups() |> \n  recomb3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"^157[A-Z0-9]{2}$\"\n\n[[2]]\n[1] \"^765[A-Z0-9]{2}$\"\n\n[[3]]\n[1] \"^E06[A-Z0-9]{2}$\"\n\n[[4]]\n[1] \"^G0[24][A-Z0-9]{2}$\"\n\n[[5]]\n[1] \"^S23[A-Z0-9]{2}$\"\n\n[[6]]\n[1] \"^0(2[1267]|3[23]|4[24]|50)[A-Z0-9]{2}$\"\n\n[[7]]\n[1] \"^2(09|25|71)[A-Z0-9]{2}$\"\n\n[[8]]\n[1] \"^3(08|12|26|4[78]|55|62)[A-Z0-9]{2}$\"\n\n[[9]]\n[1] \"^5(0[35]|44|5[23]|8[5-9])[A-Z0-9]{2}$\"\n\n[[10]]\n[1] \"^6(1[02]|30|4[46])[A-Z0-9]{2}$\"\n\n[[11]]\n[1] \"^9(2[0-2]|58)[A-Z0-9]{2}$\"\n\n[[12]]\n[1] \"^C(75|97)[A-Z0-9]{2}$\"\n```\n\n\n:::\n\n```{.r .cell-code}\nrandom_hcpcs() |>\n  split_lengths() |>\n  remove_redundant() |>\n  split_first() |>\n  process_groups() |>\n  reduce_groups() |> \n  recomb3()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n[1] \"^432[A-Z0-9]{2}$\"\n\n[[2]]\n[1] \"^786[A-Z0-9]{2}$\"\n\n[[3]]\n[1] \"^813[A-Z0-9]{2}$\"\n\n[[4]]\n[1] \"^937[A-Z0-9]{2}$\"\n\n[[5]]\n[1] \"^0(14|27)[A-Z0-9]{2}$\"\n\n[[6]]\n[1] \"^6(48|96)[A-Z0-9]{2}$\"\n\n[[7]]\n[1] \"^V(25|52)[A-Z0-9]{2}$\"\n```\n\n\n:::\n:::\n\n\n\n\n::: \n\n# Reduce Groups\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nvec_to_regex <- vrg <- \\(x, n) {\n  \n  if (empty(x)) return(character(0))\n  \n  post <- iif_else(sf_detect(x, \"^\\\\[?[A-Z]\\\\-?\"), \"[0-9]\", \"[A-Z0-9]\")\n  \n  x <- fcase(\n    n == 0, glue::glue(\"^{x}$\"),                \n    n == 1, glue::glue(\"^{x}{post}$\"),\n    n == 2, glue::glue(\"^{x}{post}{{2}}$\"),\n    n == 3, glue::glue(\"^{x}{post}{{3}}$\")\n    )\n    \n  glue::glue_collapse(x)\n}\n\nrename_reduce_groups <- \\(x) {\n  \n  list(\n    g1 = red1(x),\n    g2 = map_chr(x$g2, red2) |> map_chr(vrg, n = 3) |> glue::as_glue(),\n    g3 = map_chr(x$g3, red3) |> map_chr(vrg, n = 2) |> glue::as_glue(),\n    g4 = map_chr(x$g4, red4) |> map_chr(vrg, n = 1) |> glue::as_glue(),\n    g5 = map_chr(x$g5, red5) |> map_chr(vrg, n = 0) |> glue::as_glue()\n  )\n}\n\nall_tests[sf_nchar(all_tests) > 2] |> \n  split_lengths() |> \n  remove_redundant() |> \n  process_groups() |> \n  reduce_groups()\n\nhcpcs_tests |> \n  split_lengths() |> \n  remove_redundant() |> \n  process_groups() |> \n  reduce_groups()\n\nlong_test2 |> \n  split_lengths() |> \n  remove_redundant() |> \n  process_groups() |> \n  reduce_groups()\n\n# long_test2[nchar(long_test2) == 4]\n\nnew_test |> \n  split_lengths() |> \n  remove_redundant() |> \n  process_groups() |> \n  reduce_groups()\n\nrandom_hcpcs() |> \n  split_lengths() |> \n  remove_redundant() |> \n  process_groups() |> \n  reduce_groups()\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n{{< pagebreak >}}\n\n\n\n\n\n\n::: {#nte-references .callout-tip collapse=\"true\"}\n\n## Links\n### Reference\n\n   - [Regex Cheatsheet](https://github.com/raredd/regex)\n   - [Learn Regex](https://github.com/ziishaned/learn-regex)\n   - [Evaluating strings as code](https://josiahparry.com/posts/2024-06-13-eval-strings)\n   - [Building rules from code operands](https://github.com/Permian-Global-Research/rsi)\n   - [Filter logic](https://github.com/atorus-research/ardis/blob/main/R/denom.R)\n   - [Regular-Expression.info](https://www.regular-expressions.info/tutorial.html)\n   - [RexEgg](https://www.rexegg.com/)\n   - [Regular Expressions as used in R](https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html)\n   - [Debuggex](https://www.debuggex.com/)\n\n### Packages\n\n   - [**textshape**](https://github.com/trinker/textshape)\n   - [**stringr.plus**](https://github.com/johncassil/stringr.plus)\n   - [**regexmagic**](https://github.com/jonocarroll/regexmagic)\n   - [**makeunique**](https://github.com/selkamand/makeunique)\n   - [**similiars**](https://github.com/davidsjoberg/similiars)\n   - [**strex**](https://github.com/rorynolan/strex/)\n   - [**stringfish**](https://github.com/traversc/stringfish)\n   - [**collapse**](https://sebkrantz.github.io/collapse/)\n   - [**kit**](https://github.com/2005m/kit)\n   - [**cheapr**](https://github.com/NicChr/cheapr)\n   - [**fastplyr**](https://github.com/NicChr/fastplyr)\n   - [**stringi**](https://stringi.gagolewski.com/)\n   - [**qdapRegex**](https://github.com/trinker/qdapRegex)\n   - [**charcuterie**](https://github.com/jonocarroll/charcuterie)\n\n### Functions\n\n   - [mark::globbing](https://github.com/jmbarbone/mark/blob/main/R/glob.R)\n   - [RUtil::make_unique_comb](https://github.com/raivokolde/RUtil/blob/master/Source/R/make_unique_comb.r)\n   - [mirmisc::longest_common_substring](https://github.com/mirvie/mirmisc/blob/main/R/utils.R)\n   - [hutils::longest prefix/suffix](https://github.com/HughParsonage/hutils/blob/master/R/longest_affix.R)\n   - [tidyext::combn_2_col](https://github.com/m-clark/tidyext/blob/master/R/combn_2_col.R)\n\n::: \n\n\n## Session Information \n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n**R version 4.4.1 (2024-06-14 ucrt)**\n\n**Platform:** x86_64-w64-mingw32/x64 \n\n**locale:**\n_LC_COLLATE=English_United States.utf8_, _LC_CTYPE=English_United States.utf8_, _LC_MONETARY=English_United States.utf8_, _LC_NUMERIC=C_ and _LC_TIME=English_United States.utf8_\n\n**attached base packages:** \n_compiler_, _stats_, _graphics_, _grDevices_, _utils_, _datasets_, _methods_ and _base_\n\n**other attached packages:** \n_codex(v.0.0.0.9000)_, _emphatic(v.0.1.8)_, _kit(v.0.0.19)_, _collapse(v.2.0.17)_, _data.table(v.1.16.99)_, _stringfish(v.0.16.0)_, _vctrs(v.0.6.5)_, _cli(v.3.6.3)_, _rlang(v.1.1.4)_, _stringr(v.1.5.1)_, _purrr(v.1.0.2)_, _dplyr(v.1.1.4)_ and _fuimus(v.0.0.2)_\n\n**loaded via a namespace (and not attached):** \n_rappdirs(v.0.3.3)_, _utf8(v.1.2.4)_, _generics(v.0.1.3)_, _stringi(v.1.8.4)_, _digest(v.0.6.37)_, _magrittr(v.2.0.3)_, _evaluate(v.1.0.1)_, _fastmap(v.1.2.0)_, _rprojroot(v.2.0.4)_, _jsonlite(v.1.8.9)_, _pins(v.1.4.0)_, _pander(v.0.6.5)_, _fansi(v.1.0.6)_, _northstar(v.0.0.7)_, _textshaping(v.0.4.0)_, _RApiSerialize(v.0.1.4)_, _withr(v.3.0.2)_, _yaml(v.2.3.10)_, _tools(v.4.4.1)_, _qs(v.0.27.2)_, _parallel(v.4.4.1)_, _here(v.1.0.1)_, _R6(v.2.5.1)_, _lifecycle(v.1.0.4)_, _cheapr(v.0.9.91)_, _fs(v.1.6.5)_, _htmlwidgets(v.1.6.4)_, _ragg(v.1.3.3)_, _pkgconfig(v.2.0.3)_, _RcppParallel(v.5.1.9)_, _pillar(v.1.9.0)_, _glue(v.1.8.0)_, _Rcpp(v.1.0.13)_, _systemfonts(v.1.1.0)_, _xfun(v.0.49)_, _tibble(v.3.2.1)_, _tidyselect(v.1.2.1)_, _rstudioapi(v.0.17.1)_, _knitr(v.1.49)_, _htmltools(v.0.5.8.1)_ and _rmarkdown(v.2.29)_\n:::\n:::\n",
    "supporting": [
      "regex_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}