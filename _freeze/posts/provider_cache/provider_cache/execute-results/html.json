{
  "hash": "540f5d8df6e57be8f4e24cd784b7cfd5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"provider: Metadata Caching\"\nformat:\n  html:\n    reference-location: block\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n# National Downloadable File\n\n>   **Previous Work**\n>\n>   * [provider #60 - version 1](https://github.com/andrewallenbruce/provider/issues/60#issue-2000723817)\n>   * [provider #60 - version 2](https://github.com/andrewallenbruce/provider/issues/60#issuecomment-1820270391)\n\n\n   * [Centers for Medicare & Medicaid Services Data API](https://data.cms.gov/api-docs)\n   * [API FAQ for data.CMS.gov | OCTOBER 2024 - VERSION 1.6](https://data.cms.gov/sites/default/files/2024-10/7ef65521-65a4-41ed-b600-3a0011f8ec4b/API%20Guide%20Formatted%201_6.pdf)\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhttr2::url_parse(\"https://data.cms.gov/provider-data/api/1/datastore/query/\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n<httr2_url> https://data.cms.gov/provider-data/api/1/datastore/query/\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n• scheme: https\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n• hostname: data.cms.gov\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n• path: /provider-data/api/1/datastore/query/\n```\n\n\n:::\n\n```{.r .cell-code}\ndistro \n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError: object 'distro' not found\n```\n\n\n:::\n\n```{.r .cell-code}\nunclass(httr2::url_parse(\"?limit=1&offset=100&count=true&results=true&schema=true&keys=true&format=json&rowIds=true\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$scheme\nNULL\n\n$hostname\nNULL\n\n$username\nNULL\n\n$password\nNULL\n\n$port\nNULL\n\n$path\nNULL\n\n$query\n$query$limit\n[1] \"1\"\n\n$query$offset\n[1] \"100\"\n\n$query$count\n[1] \"true\"\n\n$query$results\n[1] \"true\"\n\n$query$schema\n[1] \"true\"\n\n$query$keys\n[1] \"true\"\n\n$query$format\n[1] \"json\"\n\n$query$rowIds\n[1] \"true\"\n\n\n$fragment\nNULL\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfname = \"affiliations\"\n\nndf_identifier <- \\(x) {\n  kit::nswitch(\n    x,\n    \"affiliations\", \"27ea-46a8\",\n    \"clinicians\", \"mj5m-pzi6\",\n    default = NA_character_,\n    nThread = 4L\n  )\n}\n\nurl_ndf <- httr2::url_parse(\"https://data.cms.gov/provider-data/api/1/metastore/schemas/dataset/items/\")\n\nurl_tmp <- url_ndf |> \n  httr2::url_build() |> \n  httr2::request()\n\nhttr2::req_template(url_tmp, \"/{fname}?show-reference-ids=true\", fname = ndf_identifier(fname))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n<httr2_request>\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nGET\nhttps://data.cms.gov/provider-data/api/1/metastore/schemas/dataset/items/27ea-46a8?show-reference-ids=true\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nBody: empty\n```\n\n\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nurl_ndf |> \n  httr2::url_build() |> \n  httr2::request() |> \n  httr2::req_url_path_append(\n    ndf_identifier(fname)\n    ) |> \n  httr2::req_url_path_append(\"?show-reference-ids=true\") |>\n  httr2::req_perform() |>\n  httr2::resp_body_json(check_type = FALSE, simplifyVector = TRUE)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmeta_ndf <- \\(fname) {\n  \n  stopifnot(curl::has_internet())\n  \n  x <- request(\n    paste0(\n      \"https://data.cms.gov/\",\n      \"provider-data/api/1/\",\n      \"metastore/schemas/\",\n      \"dataset/items/\",\n      switch(fname, \n             affiliations = \"27ea-46a8\", \n             clinicians   = \"mj5m-pzi6\", \n             stop(\"Invalid argument\")),\n    \"?show-reference-ids=true\")) |>\n       req_perform() |>\n       resp_body_json(\n         check_type     = FALSE,\n         simplifyVector = TRUE)\n  \n  distro <- gelm(gelm(x, \"distribution\"), \"identifier\")\n  \n  y <- request(\n    paste0(\n    \"https://data.cms.gov/\", \n    \"provider-data/api/1/\",\n    \"datastore/query/\", \n    distro, \n    \"?limit=1&offset=100&\",\n    \"count=true&results=true&\", \n    \"schema=true&keys=true&\",\n    \"format=json&rowIds=true\")) |>\n       req_perform() |>\n       resp_body_json(\n         check_type = FALSE,\n         simplifyVector = TRUE)\n  \n  z <- gelm(gelm(gelm(y, \"schema\"), distro), \"fields\")\n  \n  list(\n    title        = gelm(x, \"title\"),\n    description  = gelm(x, \"description\"),\n    identifier   = gelm(gelm(x, \"identifier\"), \"identifier\"),\n    distribution = distro,\n    issued       = gelm(x, \"issued\"), \n    modified     = gelm(x, \"modified\")[[1]], \n    released     = gelm(x, \"released\"),\n    dimensions   = paste0(gelm(gelm(y, \"count\"), is.numeric), \" x \", gelm(gelm(z, \"record_number\"), \"length\")), \n    fields       = names(z),\n    site         = gelm(x, \"landingPage\"),\n    csv          = gelm(gelm(gelm(x, \"distribution\"), \"data\"), \"downloadURL\", m = \"df\"),\n    dictionary   = paste0(\"https://data.cms.gov/provider-data/sites/default/files/data_dictionaries/physician/DOC_Data_Dictionary.pdf\"))\n}\n```\n:::\n\n\n\n\n### Field Comparison\n\n\n\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\"}\n\n```{.r .cell-code}\naff <- provider::affiliations(npi = 1558595660, na.rm = FALSE, tidy = FALSE)\ncat(utils::formatOL(meta_ndf(\"affiliations\")$fields, offset = 0), sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 1. record_number\n 2. npi\n 3. ind_pac_id\n 4. provider_last_name\n 5. provider_first_name\n 6. provider_middle_name\n 7. suff\n 8. facility_type\n 9. facility_affiliations_certification_number\n10. facility_type_certification_number\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(utils::formatOL(names(aff), offset = 0), sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 1. record_number\n 2. npi\n 3. ind_pac_id\n 4. provider_last_name\n 5. provider_first_name\n 6. provider_middle_name\n 7. suff\n 8. facility_type\n 9. facility_affiliations_certification_number\n10. facility_type_certification_number\n```\n\n\n:::\n:::\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\"}\n\n```{.r .cell-code}\ncln <- provider::clinicians(npi = 1558595660, na.rm = FALSE, tidy = FALSE)\ncat(utils::formatOL(meta_ndf(\"clinicians\")$fields), sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n 1. record_number\n 2. npi\n 3. ind_pac_id\n 4. ind_enrl_id\n 5. provider_last_name\n 6. provider_first_name\n 7. provider_middle_name\n 8. suff\n 9. gndr\n10. cred\n11. med_sch\n12. grd_yr\n13. pri_spec\n14. sec_spec_1\n15. sec_spec_2\n16. sec_spec_3\n17. sec_spec_4\n18. sec_spec_all\n19. telehlth\n20. facility_name\n21. org_pac_id\n22. num_org_mem\n23. adr_ln_1\n24. adr_ln_2\n25. ln_2_sprs\n26. citytown\n27. state\n28. zip_code\n29. telephone_number\n30. ind_assgn\n31. grp_assgn\n32. adrs_id\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(utils::formatOL(names(cln), offset = 1), sep = \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  1. record_number\n  2. npi\n  3. ind_pac_id\n  4. ind_enrl_id\n  5. provider_last_name\n  6. provider_first_name\n  7. provider_middle_name\n  8. suff\n  9. gndr\n 10. cred\n 11. med_sch\n 12. grd_yr\n 13. pri_spec\n 14. sec_spec_1\n 15. sec_spec_2\n 16. sec_spec_3\n 17. sec_spec_4\n 18. sec_spec_all\n 19. telehlth\n 20. facility_name\n 21. org_pac_id\n 22. num_org_mem\n 23. adr_ln_1\n 24. adr_ln_2\n 25. ln_2_sprs\n 26. citytown\n 27. state\n 28. zip_code\n 29. telephone_number\n 30. ind_assgn\n 31. grp_assgn\n 32. adrs_id\n```\n\n\n:::\n:::\n\n\n\n\n## pointblank\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\njohnd <- affiliations(npi = 1558595660, na.rm = FALSE)\n\njohnd |> \n  create_informant(\n    tbl_name = NULL,\n    label = \"Provider Facility Affiliations\"\n  ) |> \n  info_tabular(\n    `Row Definition` = \"A row has randomized values.\",\n    Source = c(\n      \"- From the **pointblank** package.\",\n      \"- [https://rstudio.github.io/pointblank/]()\"\n     )\n   ) |> \n  info_columns(\n    columns = npi,\n    info = \"10-digit National Provider Identifier.\") |>\n  info_columns(\n    columns = pac,\n    info = \"10-digit PECOS Associate Control ID.\") |>\n  info_columns(\n    columns = vars(first, middle, last, suffix),\n    info = \"Individual Provider's Name.\") |>\n  info_columns(\n    columns = facility_type,\n    info = \"Individual Provider's Name.\") |>\n  info_section(\n    section_name = \"Notes\",\n    usage = \"`affiliations(parent_ccn = '670055')`\",\n    Source = c(\n      \"- From the **(provider)** package.\",\n      \"- [CMS Affiliations API](https://data.cms.gov/provider-data/dataset/27ea-46a8)\"\n    )) |> \n  get_informant_report(\n    title = \"**`affiliations()`** Data Dictionary\",\n    size = \"standard\"\n  )\n```\n\n::: {.cell-output .cell-output-error}\n\n```\nError in get_informant_report(info_section(info_columns(info_columns(info_columns(info_columns(info_tabular(create_informant(johnd, : could not find function \"get_informant_report\"\n```\n\n\n:::\n:::\n\n\n\n\n--------------------------------------------------------------------------------\n\n# New API FAQ\n\n## Finding Data\n\n> Is there a catalog of available data?\n\nYes, the [`data.json`](https://data.cms.gov/data.json) file is an [**Open Data**](https://resources.data.gov/resources/dcat-us/) catalog containing the datasets available on our site. As new data is added, it is automatically updated to the **data.json**.\n\nIn the **data.json**, there is an array called **dataset**. You can search through this array using the title of your dataset, such as `\"Payroll Based Journal Daily Nurse Staffing\"`. Inside of the dataset, there is an array called **distribution** which will contain all the versions of the data in all available formats for each version. In this array there are a few different types of entries:\n\n   * The first entry (with a description of 'latest') will provide a URL that will always point to the latest data, even as new versions are published.\n   * The remaining entries will provide references to the data at fixed points in time, listed in descending order by date. For example, `\"https://data.cms.gov/data-api/v1/dataset/d10d792e-\nea6e-4145-8512-34efbc1be04b/data\"` will always point to the **Payroll Based Journal Daily Nurse Staffing** data from **Q2 2021**. Some datasets will have multiple historical versions available and some will only have the most recent data available.\n      * The data with mediaType of \"text/csv\" is downloadable as a CSV file and data with mediaType of \"application/zip\" is downloadable as a ZIP file.\n      * The data with a format of \"API\" will point to an API endpoint.\n\n> How can I get an earlier version of the data?\n\nIf your data has earlier versions available, there is a \"temporal\" field in the distribution section of the data.json file which will indicate the time period. An example is below.\n\nOlder Version Code Example in Python\n\nFinds the API link for the 2017 Medicare Inpatient Hospitals - by Provider and Service Data\n\nhttps://data.cms.gov/provider-summary-by-type-of-service/medicare-inpatient-hospitals/medicare-inpatient-hospitals-by-provider-and-service\n\n```python\nimport requests\n\nurl         = \"https://data.cms.gov/data.json\"\ntitle       = \"Medicare Inpatient Hospitals - by Provider and Service\"\ntime_period = \"2017-01-01/2017-12-31\"\nresponse    = requests.request(\"GET\", url)\n\nif response.ok:\n    response = response.json()\n    dataset = response['dataset']\n    for set in dataset:\n        if title == set['title']:\n            for distro in set['distribution']:\n                if 'format' in distro.keys():\n                    if distro['format'] == \"API\" and distro['temporal'] == time_period:\n                        print(f\"API link for {title} from {time_period} is {distro['accessURL']}\")\n```\n\n--------------------------------------------------------------------------------\n\n## Session Information \n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n**R version 4.4.2 (2024-10-31 ucrt)**\n\n**Platform:** x86_64-w64-mingw32/x64 \n\n**locale:**\n_LC_COLLATE=English_United States.utf8_, _LC_CTYPE=English_United States.utf8_, _LC_MONETARY=English_United States.utf8_, _LC_NUMERIC=C_ and _LC_TIME=English_United States.utf8_\n\n**attached base packages:** \n_stats_, _graphics_, _grDevices_, _utils_, _datasets_, _methods_ and _base_\n\n**other attached packages:** \n_httr2(v.1.0.7)_, _fuimus(v.0.0.5.9004)_, _provider(v.0.0.1.9000)_, _collapse(v.2.0.18)_, _kit(v.0.0.19)_, _magrittr(v.2.0.3)_, _data.table(v.1.16.99)_, _fastverse(v.0.3.4)_, _lubridate(v.1.9.4)_, _forcats(v.1.0.0)_, _stringr(v.1.5.1)_, _dplyr(v.1.1.4)_, _purrr(v.1.0.2)_, _readr(v.2.1.5)_, _tidyr(v.1.3.1.9000)_, _tibble(v.3.2.1)_, _ggplot2(v.3.5.1)_ and _tidyverse(v.2.0.0)_\n\n**loaded via a namespace (and not attached):** \n_rappdirs(v.0.3.3)_, _utf8(v.1.2.4)_, _generics(v.0.1.3)_, _stringi(v.1.8.4)_, _hms(v.1.1.3)_, _digest(v.0.6.37)_, _evaluate(v.1.0.1)_, _grid(v.4.4.2)_, _timechange(v.0.3.0)_, _fastmap(v.1.2.0)_, _jsonlite(v.1.8.9)_, _pander(v.0.6.5)_, _fansi(v.1.0.6)_, _scales(v.1.3.0)_, _textshaping(v.0.4.1)_, _cli(v.3.6.3)_, _rlang(v.1.1.4)_, _munsell(v.0.5.1)_, _withr(v.3.0.2)_, _yaml(v.2.3.10)_, _tools(v.4.4.2)_, _parallel(v.4.4.2)_, _tzdb(v.0.4.0)_, _zeallot(v.0.1.0)_, _colorspace(v.2.1-1)_, _curl(v.6.0.1)_, _vctrs(v.0.6.5)_, _R6(v.2.5.1)_, _lifecycle(v.1.0.4)_, _snakecase(v.0.11.1)_, _htmlwidgets(v.1.6.4)_, _janitor(v.2.2.0)_, _ragg(v.1.3.3)_, _pkgconfig(v.2.0.3)_, _pillar(v.1.9.0)_, _gtable(v.0.3.6)_, _glue(v.1.8.0)_, _Rcpp(v.1.0.13-1)_, _systemfonts(v.1.1.0)_, _xfun(v.0.49)_, _tidyselect(v.1.2.1)_, _rstudioapi(v.0.17.1)_, _knitr(v.1.49)_, _htmltools(v.0.5.8.1)_, _rmarkdown(v.2.29)_ and _compiler(v.4.4.2)_\n:::\n:::\n",
    "supporting": [
      "provider_cache_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}