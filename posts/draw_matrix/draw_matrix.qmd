---
title: "PCS Code as a Matrix"
format:
  html:
    reference-location: block
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: setup
#| echo: true
#| message: false
#| warning: false

knitr::opts_chunk$set(
  dev = "ragg_png",
  dpi = 320,
  out.width = "100%",
  fig.width = 8,
  fig.asp = 0.818,
  fig.retina = 2,
  fig.align = "center",
  fig.show = "hold"
)
options(scipen = 999)

library(tidyverse)
library(ggthemes)
library(drawr)
library(fuimus)
library(procedural)
library(drawr)
```

```{r}
#| echo: true
#| message: false
#| warning: false
look <- function(x) {
  
  x             <- fuimus::splitter(stringfish::sf_toupper(x))
  values        <- 1:34
  names(values) <- c(0:9, LETTERS[c(1:8, 10:14, 16:26)])
  unname(values[x])
  
}

pcs_matrix <- function(x) {
  
  axis   <- c(1:7)
  value  <- c(0:9, LETTERS[c(1:8, 10:14, 16:26)])
  
  m <- matrix(data     = 0L,
              nrow     = length(value),
              ncol     = length(axis),
              dimnames = list(value, axis))
  
  x <- look(x)
  y <- 1L
  
  m[x[1], 1] <- y
  m[x[2], 2] <- y
  m[x[3], 3] <- y
  m[x[4], 4] <- y
  m[x[5], 5] <- y
  m[x[6], 6] <- y
  m[x[7], 7] <- y
  
  return(m)
}
```


```{r}
#| echo: true
#| message: false
#| warning: false
pcs_matrix("0G9000Z")
```


```{r}
#| echo: true
#| message: false
#| warning: false
x <- pcs_matrix("0G9000Z")

gdraw_matrix(
  x, 
  highlight_area = x == 1, 
  show_indices = "none",
  graph_title = "ICD-10-PCS Code 0G9000Z",
  graph_subtitle = NULL) + 
  theme_solid() + 
  ylim(rev(rownames(x))) + 
  xlim(colnames(x)) + 
  xlab("") + 
  ylab("") +
  theme(
    legend.position = "none",
    axis.text.x = element_text(size = 11),
    axis.text.y = element_text(size = 11),
    axis.ticks.x = element_blank(),
    axis.ticks.y = element_blank(),
    )
```


{{< pagebreak >}}

```{r}
sessioninfo::session_info()
```
