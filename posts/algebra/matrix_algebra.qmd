---
title: "Matrices and RVUs"
draft: true
format:
  html:
    other-links:
      - text: Individual Psychometrics
        icon: bookmark-plus
        href: https://wjschne.github.io/individualpsychometrics/matrix_algebra.html
    mermaid:
      theme: default
    embed-resources: true
    code-link: true
---

```{r setup}
#| eval: false
#| echo: false
#| message: false
#| warning: false
#| comment: ""
#| dev: "ragg_png"
#| out.width: "100%"
#| fig.align: "center"
#| fig.width: 8

library(tidyverse)
library(extrafont)
loadfonts("win", quiet = TRUE)

library(sn)
library(fMultivar)
library(IDPmisc)
library(psych)
library(scales)

library(gganimate)
library(ggforce)
library(sjmisc)
library(WJSmisc)

library(tikzDevice)
library(patchwork)
library(qualvar)
library(modeest)
library(tinter)
library(ggfx)
library(ggtext)
library(lemon)
library(signs)

library(psycheval)
library(bezier)
library(DescTools)
library(ggh4x)
library(ggthemes)
library(rsvg)
library(ggarrow)
library(arrowheadr)

arrow_head_deltoid <- purrr::partial(
  arrowheadr::arrow_head_deltoid, 
  d = 2.3
  )

# Set options
# options(knitr.kable.digits = 2, knitr.kable.na = '')
# 
# knitr::opts_template$set(
#   marginfigure = list(fig.column = "margin", 
#                       fig.cap.location = "top", 
#                       out.width = "100%", 
#                       fig.align = "left"),
#   bodyfigure = list(fig.column = "body", 
#                     fig.cap.location = "margin"))

# Default fonts and colors
bfont = "Equity Text A Tab"
bsize = 16
myfills <- c("royalblue4", "firebrick4", "#51315E")

btxt_size = ggtext_size(bsize)

# Default geoms and themes
ggplot2::update_geom_defaults("text",
                              list(family = bfont, size = btxt_size))
ggplot2::update_geom_defaults("label",
                              list(
                                family = bfont,
                                size = btxt_size,
                                label.padding = unit(0, "lines"),
                                label.size = 0
                              ))

ggplot2::update_geom_defaults("richtext",
                              list(family = bfont, size = btxt_size))

ggplot2::update_geom_defaults("density", list(fill = myfills[1]))
geom_text_fill <- function(...) {
  geom_label(...,
             label.padding = unit(0, "lines"),
             label.size = 0)
}
theme_set(theme_minimal(base_size = bsize, base_family = bfont))


# font family
span_style <- function(x, style = "font-family:serif") {
  paste0('<span style=\"', style, '\">', x, "</span>")
}


# Set table column width
# https://github.com/rstudio/bookdown/issues/122#issuecomment-221101375
html_table_width <- \(kable_output, width, tag = "</caption>"){
  width_html <- paste0(paste0('<col width="', width, '">'), collapse = "\n")
  sub(tag, paste0(tag, "\n", width_html), kable_output)
}

# Make a matrix with braces
bmatrix <- \(M, brace = "bmatrix", includenames=TRUE) {
  
  if (includenames) {
    M <- cbind(rownames(M), M)
    M <- rbind(colnames(M), M)
  }
  M <-  paste(apply(M, MARGIN = 1, FUN = paste0, collapse = " & "), collapse = "\\\\\n")

  if (!is.null(brace)) {
    M <- paste0("\\begin{", brace, "}\n", M, "\n\\end{", brace, "}")
    }
  M
}
```


